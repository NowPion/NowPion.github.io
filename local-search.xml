<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>é¡µé¢åˆ·æ–°åcookieæ¶ˆå¤±çš„bug</title>
    <link href="/2025/11/01/%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E5%90%8Ecookie%E6%B6%88%E5%A4%B1%E7%9A%84bug/"/>
    <url>/2025/11/01/%E9%A1%B5%E9%9D%A2%E5%88%B7%E6%96%B0%E5%90%8Ecookie%E6%B6%88%E5%A4%B1%E7%9A%84bug/</url>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜å‘ç°"><a href="#é—®é¢˜å‘ç°" class="headerlink" title="é—®é¢˜å‘ç°"></a>é—®é¢˜å‘ç°</h1><p>ä»Šå¤©åœ¨ç”¨ Cookie åšç™»å½•æ€æ—¶é‡åˆ°ä¸€ä¸ªè¯¡å¼‚é—®é¢˜ï¼šåˆ·æ–°é¡µé¢åï¼ŒCookie è‡ªåŠ¨æ¶ˆå¤±ï¼›å¹¶ä¸”å†æ¬¡å‘èµ·è¯·æ±‚ä¹Ÿä¸æºå¸¦ Cookieã€‚</p><hr><h2 id="å¤ç°"><a href="#å¤ç°" class="headerlink" title="å¤ç°"></a>å¤ç°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> userApi = &#123;<br>  <span class="hljs-comment">// å‘é€ç™»å½•éªŒè¯ç </span><br>  <span class="hljs-title function_">sendLoginCode</span>(<span class="hljs-params">phone</span>) &#123;<br>    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">postForm</span>(<span class="hljs-string">&#x27;/userLogin/sendLoginCode&#x27;</span>, &#123; phone &#125;)<br>  &#125;,<br><br>  <span class="hljs-comment">// æ‰‹æœºå·+éªŒè¯ç ç™»å½•</span><br>  <span class="hljs-title function_">login</span>(<span class="hljs-params">phone, code</span>) &#123;<br>    <span class="hljs-keyword">return</span> api.<span class="hljs-title function_">postForm</span>(<span class="hljs-string">&#x27;/userLogin/login&#x27;</span>, &#123; phone, code &#125;)<br>  &#125;,<br>&#125;<br><span class="hljs-comment">//åœ¨å‘é€å®Œè¯·æ±‚åæˆåŠŸè·å–äº†cookie</span><br></code></pre></td></tr></table></figure><p><img src="https://newpon.top/PicGo/image-20251101171555217.png" alt="image-20251101171555217"></p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">ç°è±¡ï¼š<br><span class="hljs-bullet">- </span>å‘é€æ–°çš„è¯·æ±‚å¹¶ä¸ä¼šæºå¸¦ Cookie<br><span class="hljs-bullet">- </span>é¡µé¢åˆ·æ–°å Cookie å°±ä¼šæ¶ˆå¤±<br></code></pre></td></tr></table></figure><hr><h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p><img src="https://newpon.top/PicGo/image-20251101172152297.png" alt="image-20251101172152297"></p><p>æµè§ˆå™¨ä¸ºäº†æé«˜å®‰å…¨æ€§ï¼Œè¦æ±‚æ‰€æœ‰è®¾ç½®äº† <code>SameSite=None</code> çš„ cookies éƒ½å¿…é¡»ä½¿ç”¨ <code>Secure</code> å±æ€§ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä»…é€šè¿‡ HTTPS å‘é€ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œå…¶ä»–å®‰å…¨æ¼æ´</p><p>è¿›ä¸€æ­¥è¯´æ˜ï¼š</p><ul><li>Chrome ç­‰ç°ä»£æµè§ˆå™¨å¯¹ <code>SameSite=None</code> çš„ Cookieï¼Œå¦‚æœæ²¡æœ‰åŒæ—¶è®¾ç½® <code>Secure</code>ï¼Œä¼šç›´æ¥æ‹’ç»æˆ–åœ¨åˆ·æ–°åä¸¢å¼ƒã€‚</li><li>æœ¬åœ°å¼€å‘è‹¥ä½¿ç”¨ <code>http://localhost</code>ï¼Œå³ä½¿æ˜¯åŒæºï¼Œè‹¥ä½ çš„åç«¯è®¾ç½®äº† <code>SameSite=None</code>ï¼Œä¹Ÿå¿…é¡»é…åˆ <code>Secure</code> å¹¶é€šè¿‡ HTTPS ä¼ è¾“ï¼Œå¦åˆ™æµè§ˆå™¨ä¸äºˆä¿ç•™&#x2F;å‘é€ã€‚</li></ul><hr><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>æœåŠ¡å™¨ç«¯æ­£ç¡®è®¾ç½® Cookieï¼ˆç¤ºä¾‹ä»¥ Node.js&#x2F;Expressï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// æœåŠ¡å™¨: è®¾ç½®ç™»å½•æ€ Cookie</span><br>res.<span class="hljs-title function_">cookie</span>(<span class="hljs-string">&#x27;token&#x27;</span>, token, &#123;<br>  <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,      <span class="hljs-comment">// é¿å… JS è®¿é—®ï¼Œé™ä½ XSS é£é™©</span><br>  <span class="hljs-attr">secure</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// åªåœ¨ HTTPS ä¸‹å‘é€ï¼ˆSameSite=None å¿…é¡»æ­é…ï¼‰</span><br>  <span class="hljs-attr">sameSite</span>: <span class="hljs-string">&#x27;None&#x27;</span>,    <span class="hljs-comment">// è·¨ç«™è¯·æ±‚éœ€è¦æºå¸¦ Cookie</span><br>  <span class="hljs-attr">maxAge</span>: <span class="hljs-number">7</span> * <span class="hljs-number">24</span> * <span class="hljs-number">3600</span> * <span class="hljs-number">1000</span>, <span class="hljs-comment">// 7 å¤©</span><br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,<br>&#125;)<br></code></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯å¼€å¯æºå¸¦å‡­æ®ï¼ˆä»¥ Axios ä¸ºä¾‹ï¼‰ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;axios&#x27;</span><br><br>axios.<span class="hljs-property">defaults</span>.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span><br><span class="hljs-comment">// æˆ–è€…: axios.create(&#123; withCredentials: true &#125;)</span><br><br><span class="hljs-comment">// å‘èµ·è¯·æ±‚</span><br>axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">&#x27;https://api.example.com/userLogin/login&#x27;</span>, &#123; phone, code &#125;)<br></code></pre></td></tr></table></figure><p>æœåŠ¡ç«¯ CORS å¿…é¡»å…è®¸æºå¸¦å‡­æ®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// Express CORS</span><br><span class="hljs-keyword">import</span> cors <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;cors&#x27;</span><br>app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>(&#123;<br>  <span class="hljs-attr">origin</span>: <span class="hljs-string">&#x27;https://web.example.com&#x27;</span>, <span class="hljs-comment">// ä¸èƒ½ç”¨ *ï¼Œéœ€æ˜ç¡®æ¥æº</span><br>  <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span>,                  <span class="hljs-comment">// å…è®¸å‡­æ®ï¼ˆCookieï¼‰</span><br>&#125;))<br><br><span class="hljs-comment">// æˆ–æ‰‹åŠ¨è®¾ç½®å¤´</span><br>res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="hljs-string">&#x27;https://web.example.com&#x27;</span>)<br>res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>)<br></code></pre></td></tr></table></figure><p>åŸŸä¸è·¯å¾„è®¾ç½®ï¼š</p><ul><li><code>domain</code> åº”è®¾ç½®ä¸ºéœ€è¦ç”Ÿæ•ˆçš„ä¸»åŸŸæˆ–å­åŸŸï¼Œé¿å…è·¨åŸŸä¸åŒ¹é…ã€‚</li><li><code>path</code> ä¸€èˆ¬è®¾ä¸º <code>/</code>ï¼Œå¦åˆ™éƒ¨åˆ†è·¯ç”±ä¸‹ä¸ä¼šå‘é€ Cookieã€‚</li></ul><hr><h2 id="æœ¬åœ°å¼€å‘çš„å¯é€‰æ–¹æ¡ˆ"><a href="#æœ¬åœ°å¼€å‘çš„å¯é€‰æ–¹æ¡ˆ" class="headerlink" title="æœ¬åœ°å¼€å‘çš„å¯é€‰æ–¹æ¡ˆ"></a>æœ¬åœ°å¼€å‘çš„å¯é€‰æ–¹æ¡ˆ</h2><ul><li>ä½¿ç”¨ HTTPSï¼šé€šè¿‡ Nginx&#x2F;Caddy åå‘ä»£ç†æœ¬åœ°æœåŠ¡å¹¶ç­¾å‘æœ¬åœ°è¯ä¹¦ï¼ˆå¯ç”¨ <code>mkcert</code> ä¿¡ä»»å¼€å‘è¯ä¹¦ï¼‰ã€‚</li><li>å¦‚æœæš‚æ—¶æ— æ³• HTTPSï¼Œåˆéœ€è¦è·¨ç«™æºå¸¦ Cookieï¼š<ul><li>é¿å…ä½¿ç”¨ <code>SameSite=None</code>ï¼Œæ”¹ä¸ºåŒç«™å¼€å‘ï¼ˆå‰åç«¯åŒæºï¼‰ï¼Œæˆ–åœ¨éœ€è¦æ—¶ä½¿ç”¨ Token æ–¹æ¡ˆã€‚</li><li>ä½†æ³¨æ„ï¼š<code>SameSite=Lax/Strict</code> åœ¨è·¨ç«™è¯·æ±‚åœºæ™¯ä¸‹é€šå¸¸ä¸ä¼šæºå¸¦ Cookieã€‚</li></ul></li></ul><hr><h2 id="å¸¸è§å‘æ’æŸ¥æ¸…å•"><a href="#å¸¸è§å‘æ’æŸ¥æ¸…å•" class="headerlink" title="å¸¸è§å‘æ’æŸ¥æ¸…å•"></a>å¸¸è§å‘æ’æŸ¥æ¸…å•</h2><ul><li>æ˜¯å¦è®¾ç½®äº† <code>SameSite=None</code> å´æ²¡æœ‰ <code>Secure</code>ã€‚</li><li>æ˜¯å¦å¯ç”¨äº† <code>withCredentials</code>ï¼ŒåŒæ—¶æœåŠ¡ç«¯ <code>Access-Control-Allow-Credentials: true</code> ä¸” <code>Allow-Origin</code> ä¸ºå…·ä½“åŸŸã€‚</li><li>Cookie æ˜¯å¦ä¸º <code>HttpOnly</code>ï¼ˆJS ä¸å¯è¯»ï¼‰ï¼Œä½†è¿™ä¸ä¼šå½±å“è¯·æ±‚æ˜¯å¦æºå¸¦ã€‚</li><li>æ˜¯å¦è®¾ç½®äº† <code>domain</code>&#x2F;<code>path</code> å¯¼è‡´ä½œç”¨åŸŸä¸åŒ¹é…ã€‚</li><li>æ˜¯å¦ä»…ä¸ºâ€œä¼šè¯ Cookieâ€ï¼ˆæ—  <code>Expires/Max-Age</code>ï¼‰ï¼šåˆ·æ–°é€šå¸¸ä¸ä¸¢å¤±ï¼Œä½†å…³é—­æµè§ˆå™¨ä¼šå¤±æ•ˆã€‚</li><li>æ˜¯å¦å­˜åœ¨å­åŸŸ&#x2F;ç«¯å£ä¸åŒå¯¼è‡´è·¨ç«™ã€‚</li></ul><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆ·æ–°å Cookie æ¶ˆå¤±ï¼Œå¾€å¾€æ˜¯å› ä¸ºæµè§ˆå™¨çš„æ–°å®‰å…¨ç­–ç•¥ï¼š<code>SameSite=None</code> å¿…é¡»é…åˆ <code>Secure</code> ä¸”é€šè¿‡ HTTPS ä¼ è¾“ã€‚é…åˆå‰ç«¯ <code>withCredentials</code> å’ŒæœåŠ¡ç«¯æ­£ç¡®çš„ CORS è®¾ç½®ï¼Œå¹¶ç¡®ä¿åŸŸä¸è·¯å¾„åŒ¹é…ï¼Œå³å¯ç¨³å®šä¿ç•™ä¸æºå¸¦ Cookieã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å‰ç«¯</tag>
      
      <tag>Cookie</tag>
      
      <tag>CORS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Spring Boot æ•´åˆæ”¯ä»˜å®</title>
    <link href="/2025/10/30/SpringBoot%E6%95%B4%E5%90%88%E6%94%AF%E4%BB%98%E5%AE%9D/"/>
    <url>/2025/10/30/SpringBoot%E6%95%B4%E5%90%88%E6%94%AF%E4%BB%98%E5%AE%9D/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€å‰æå‡†å¤‡"><a href="#ä¸€ã€å‰æå‡†å¤‡" class="headerlink" title="ä¸€ã€å‰æå‡†å¤‡"></a>ä¸€ã€å‰æå‡†å¤‡</h1><p>åœ¨å¼€å§‹æ•´åˆä¹‹å‰ï¼Œä½ éœ€è¦å‡†å¤‡ä»¥ä¸‹é…ç½®ï¼š</p><ul><li><strong>AppID</strong>ï¼šæ”¯ä»˜å®åº”ç”¨å”¯ä¸€æ ‡è¯†  </li><li><strong>åº”ç”¨ç§é’¥ï¼ˆappPrivateKeyï¼‰</strong>ï¼šè‡ªå·±ç”Ÿæˆï¼Œç”¨äºç­¾å  </li><li><strong>æ”¯ä»˜å®å…¬é’¥ï¼ˆalipayPublicKeyï¼‰</strong>ï¼šä»æ”¯ä»˜å®å¼€æ”¾å¹³å°è·å–  </li><li><strong>åº”ç”¨å…¬é’¥ï¼ˆappPublicKeyï¼‰</strong>ï¼šé…ç½®åœ¨æ”¯ä»˜å®åå°  </li><li><strong>å¼‚æ­¥å›è°ƒåœ°å€ï¼ˆnotifyUrlï¼‰</strong>ï¼šæ”¯ä»˜æˆåŠŸåæ”¯ä»˜å®é€šçŸ¥çš„æ¥å£  </li><li><strong>æ”¯ä»˜å®ç½‘å…³åœ°å€</strong>ï¼ˆæ²™ç®±ç¯å¢ƒä¸º <code>https://openapi-sandbox.dl.alipaydev.com/gateway.do</code>ï¼‰</li></ul><hr><h1 id="äºŒã€Maven-ä¾èµ–"><a href="#äºŒã€Maven-ä¾èµ–" class="headerlink" title="äºŒã€Maven ä¾èµ–"></a>äºŒã€Maven ä¾èµ–</h1><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- æ”¯ä»˜å® Easy SDK --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alipay.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>alipay-easysdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- æ”¯ä»˜å®å®˜æ–¹ Java SDK --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alipay.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>alipay-sdk-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.34.0.ALL<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ æ¨èä½¿ç”¨ <strong>Easy SDK</strong> è¿›è¡Œä¸šåŠ¡å°è£…ï¼Œä½†å¦‚éœ€æ›´çµæ´»çš„æ§åˆ¶ï¼Œå¯é…åˆå®˜æ–¹ SDK ä¸€èµ·ä½¿ç”¨ã€‚</p></blockquote><hr><h1 id="ä¸‰ã€é…ç½®æ–‡ä»¶ï¼ˆapplication-ymlï¼‰"><a href="#ä¸‰ã€é…ç½®æ–‡ä»¶ï¼ˆapplication-ymlï¼‰" class="headerlink" title="ä¸‰ã€é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰"></a>ä¸‰ã€é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h1><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">alipay:</span><br>  <span class="hljs-attr">appId:</span>           <span class="hljs-comment"># æ”¯ä»˜å®åº”ç”¨AppID</span><br>  <span class="hljs-attr">appPrivateKey:</span>   <span class="hljs-comment"># åº”ç”¨ç§é’¥</span><br>  <span class="hljs-attr">alipayPublicKey:</span> <span class="hljs-comment"># æ”¯ä»˜å®å…¬é’¥</span><br>  <span class="hljs-attr">notifyUrl:</span>       <span class="hljs-comment"># æ”¯ä»˜æˆåŠŸåçš„å¼‚æ­¥å›è°ƒåœ°å€</span><br></code></pre></td></tr></table></figure><hr><h1 id="å››ã€æ”¯ä»˜å®é…ç½®ç±»åˆå§‹åŒ–"><a href="#å››ã€æ”¯ä»˜å®é…ç½®ç±»åˆå§‹åŒ–" class="headerlink" title="å››ã€æ”¯ä»˜å®é…ç½®ç±»åˆå§‹åŒ–"></a>å››ã€æ”¯ä»˜å®é…ç½®ç±»åˆå§‹åŒ–</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-meta">@ConfigurationProperties(prefix = &quot;alipay&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AliPayConfig</span> &#123;<br>    <span class="hljs-keyword">private</span> String appId;<br>    <span class="hljs-keyword">private</span> String appPrivateKey;<br>    <span class="hljs-keyword">private</span> String alipayPublicKey;<br>    <span class="hljs-keyword">private</span> String notifyUrl;<br><br>    <span class="hljs-meta">@PostConstruct</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>        config.protocol = <span class="hljs-string">&quot;https&quot;</span>;<br>        config.gatewayHost = <span class="hljs-string">&quot;openapi.alipaydev.com&quot;</span>; <span class="hljs-comment">// æ²™ç®±ç½‘å…³</span><br>        config.signType = <span class="hljs-string">&quot;RSA2&quot;</span>;<br>        config.appId = <span class="hljs-built_in">this</span>.appId;<br>        config.merchantPrivateKey = <span class="hljs-built_in">this</span>.appPrivateKey;<br>        config.alipayPublicKey = <span class="hljs-built_in">this</span>.alipayPublicKey;<br>        config.notifyUrl = <span class="hljs-built_in">this</span>.notifyUrl;<br>        Factory.setOptions(config);<br>        System.out.println(<span class="hljs-string">&quot;âœ… æ”¯ä»˜å®SDKåˆå§‹åŒ–æˆåŠŸ&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="äº”ã€æ”¯ä»˜ä¸å›è°ƒæ¥å£"><a href="#äº”ã€æ”¯ä»˜ä¸å›è°ƒæ¥å£" class="headerlink" title="äº”ã€æ”¯ä»˜ä¸å›è°ƒæ¥å£"></a>äº”ã€æ”¯ä»˜ä¸å›è°ƒæ¥å£</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/alipay&quot;)</span><br><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AliPayController</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> AliPayConfig aliPayConfig;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">GATEWAY_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://openapi-sandbox.dl.alipaydev.com/gateway.do&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FORMAT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;JSON&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CHARSET</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;utf-8&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">SIGN_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;RSA2&quot;</span>;<br><br>    <span class="hljs-comment">/** è·å–æ”¯ä»˜äºŒç»´ç  **/</span><br>    <span class="hljs-meta">@GetMapping(&quot;/pay&quot;)</span> <span class="hljs-comment">// /alipay/pay?subject=æµ‹è¯•è®¢å•&amp;traceNo=123456&amp;totalAmount=0.01</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">pay</span><span class="hljs-params">(AliPay aliPay)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">AlipayClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAlipayClient</span>(<br>                GATEWAY_URL,<br>                aliPayConfig.getAppId(),<br>                aliPayConfig.getAppPrivateKey(),<br>                FORMAT,<br>                CHARSET,<br>                aliPayConfig.getAlipayPublicKey(),<br>                SIGN_TYPE<br>        );<br><br>        <span class="hljs-type">AlipayTradePrecreateRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayTradePrecreateRequest</span>();<br>        <span class="hljs-type">AlipayTradePrecreateModel</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlipayTradePrecreateModel</span>();<br>        model.setOutTradeNo(aliPay.getTraceNo());<br>        model.setSubject(aliPay.getSubject());<br>        model.setTotalAmount(String.valueOf(aliPay.getTotalAmount()));<br>        request.setBizModel(model);<br>        request.setNotifyUrl(aliPayConfig.getNotifyUrl());<br><br>        <span class="hljs-type">AlipayTradePrecreateResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.execute(request);<br>        <span class="hljs-keyword">return</span> response;<br>    &#125;<br><br>    <span class="hljs-comment">/** æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥å›è°ƒ **/</span><br>    <span class="hljs-meta">@PostMapping(&quot;/notify&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">notify</span><span class="hljs-params">(HttpServletRequest request)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;TRADE_SUCCESS&quot;</span>.equals(request.getParameter(<span class="hljs-string">&quot;trade_status&quot;</span>))) &#123;<br>            System.out.println(<span class="hljs-string">&quot;========= æ”¯ä»˜å®å¼‚æ­¥å›è°ƒ =========&quot;</span>);<br><br>            Map&lt;String, String&gt; params = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>            request.getParameterMap().forEach((k, v) -&gt; params.put(k, v[<span class="hljs-number">0</span>]));<br><br>            <span class="hljs-keyword">if</span> (Factory.Payment.Common().verifyNotify(params)) &#123;<br>                <span class="hljs-comment">// âœ… éªŒç­¾é€šè¿‡</span><br>                System.out.println(<span class="hljs-string">&quot;äº¤æ˜“åç§°: &quot;</span> + params.get(<span class="hljs-string">&quot;subject&quot;</span>));<br>                System.out.println(<span class="hljs-string">&quot;äº¤æ˜“çŠ¶æ€: &quot;</span> + params.get(<span class="hljs-string">&quot;trade_status&quot;</span>));<br>                System.out.println(<span class="hljs-string">&quot;æ”¯ä»˜å®äº¤æ˜“å‡­è¯å·: &quot;</span> + params.get(<span class="hljs-string">&quot;trade_no&quot;</span>));<br>                System.out.println(<span class="hljs-string">&quot;å•†æˆ·è®¢å•å·: &quot;</span> + params.get(<span class="hljs-string">&quot;out_trade_no&quot;</span>));<br>                System.out.println(<span class="hljs-string">&quot;äº¤æ˜“é‡‘é¢: &quot;</span> + params.get(<span class="hljs-string">&quot;total_amount&quot;</span>));<br>                System.out.println(<span class="hljs-string">&quot;ä¹°å®¶ID: &quot;</span> + params.get(<span class="hljs-string">&quot;buyer_id&quot;</span>));<br>                System.out.println(<span class="hljs-string">&quot;ä»˜æ¬¾æ—¶é—´: &quot;</span> + params.get(<span class="hljs-string">&quot;gmt_payment&quot;</span>));<br>                <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> æ›´æ–°è®¢å•çŠ¶æ€ä¸ºâ€œå·²æ”¯ä»˜â€</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h1 id="å…­ã€ç”Ÿæˆæ”¯ä»˜äºŒç»´ç "><a href="#å…­ã€ç”Ÿæˆæ”¯ä»˜äºŒç»´ç " class="headerlink" title="å…­ã€ç”Ÿæˆæ”¯ä»˜äºŒç»´ç "></a>å…­ã€ç”Ÿæˆæ”¯ä»˜äºŒç»´ç </h1><p>è¿”å›çš„ JSON æ•°æ®ä¸­ä¼šåŒ…å«ä¸€ä¸ª <code>qrCode</code> å­—æ®µï¼Œ<br>å¯ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·ï¼ˆå¦‚ <code>ZXing</code>ï¼‰ç”ŸæˆäºŒç»´ç è¿›è¡Œæ‰«ç æ”¯ä»˜ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">qrCode</span> <span class="hljs-operator">=</span> response.getQrCode();<br>QRCodeUtil.generate(qrCode, <span class="hljs-string">&quot;alipay_qr.png&quot;</span>);<br></code></pre></td></tr></table></figure><blockquote><p>åœ¨æ”¯ä»˜å®æ²™ç®±æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨æ²™ç®±é’±åŒ… App æ‰«ç æ¨¡æ‹Ÿæ”¯ä»˜ã€‚</p></blockquote><hr><h1 id="ä¸ƒã€å¸¸è§é—®é¢˜-å»ºè®®"><a href="#ä¸ƒã€å¸¸è§é—®é¢˜-å»ºè®®" class="headerlink" title="ä¸ƒã€å¸¸è§é—®é¢˜ &amp; å»ºè®®"></a>ä¸ƒã€å¸¸è§é—®é¢˜ &amp; å»ºè®®</h1><ol><li><p><strong>æµ‹è¯•ç¯å¢ƒ</strong><br>   ä½¿ç”¨ <a href="https://open.alipay.com/developmentAccess/devSandbox">æ”¯ä»˜å®å¼€æ”¾å¹³å°æ²™ç®±ç¯å¢ƒ</a> æµ‹è¯•ï¼Œæ— éœ€çœŸå®æ”¯ä»˜ã€‚  </p></li><li><p><strong>å¼‚æ­¥é€šçŸ¥</strong><br>   å›è°ƒæ¥å£å¿…é¡»ä¸ºå…¬ç½‘å¯è®¿é—®åœ°å€ï¼Œå¦åˆ™æ”¯ä»˜å®æ— æ³•å›è°ƒã€‚  </p></li><li><p><strong>å¯†é’¥å®‰å…¨</strong><br>   è¯·å‹¿åœ¨å‰ç«¯æˆ–å…¬å¼€ä»“åº“æš´éœ²ç§é’¥ä¿¡æ¯ã€‚  </p></li><li><p><strong>ç”Ÿäº§ç¯å¢ƒç½‘å…³</strong><br>   æ­£å¼ç¯å¢ƒç½‘å…³ä¸º <code>https://openapi.alipay.com/gateway.do</code>ã€‚</p></li></ol><hr><h1 id="å…«ã€æ€»ç»“"><a href="#å…«ã€æ€»ç»“" class="headerlink" title="å…«ã€æ€»ç»“"></a>å…«ã€æ€»ç»“</h1><p>æœ¬æ–‡é€šè¿‡ç®€å•çš„é…ç½®å’Œä»£ç å®ç°äº†ï¼š</p><ul><li>æ”¯ä»˜å® SDK åˆå§‹åŒ–  </li><li>ç”Ÿæˆæ”¯ä»˜äºŒç»´ç æ¥å£  </li><li>å¼‚æ­¥å›è°ƒéªŒç­¾é€»è¾‘</li></ul><p>è‡³æ­¤ï¼Œä¸€ä¸ªå®Œæ•´çš„ <strong>æ”¯ä»˜å®æ‰«ç æ”¯ä»˜åŠŸèƒ½</strong> å°±æ•´åˆå®Œæˆäº†ã€‚<br>å¦‚éœ€æ‰©å±•ï¼Œå¯ç»§ç»­å®ç°é€€æ¬¾ã€æŸ¥è¯¢ã€å…³é—­è®¢å•ç­‰æ¥å£ã€‚</p><hr><blockquote><p>âœï¸ <em>Author: NowPion</em><br>ğŸ’¬ â€œç”¨ä»£ç é©±åŠ¨ä¸šåŠ¡ï¼Œè®©æ”¯ä»˜æ›´ç®€å•ã€‚â€</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring Boot</tag>
      
      <tag>æ”¯ä»˜å®</tag>
      
      <tag>æ”¯ä»˜é›†æˆ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Nginxä¸Caddy</title>
    <link href="/2025/10/25/Nginx%E4%B8%8ECaddy/"/>
    <url>/2025/10/25/Nginx%E4%B8%8ECaddy/</url>
    
    <content type="html"><![CDATA[<h1 id="Nginx-ä¸-Caddyï¼šç‰¹ç‚¹ã€åŒºåˆ«ä¸-Docker-éƒ¨ç½²"><a href="#Nginx-ä¸-Caddyï¼šç‰¹ç‚¹ã€åŒºåˆ«ä¸-Docker-éƒ¨ç½²" class="headerlink" title="Nginx ä¸ Caddyï¼šç‰¹ç‚¹ã€åŒºåˆ«ä¸ Docker éƒ¨ç½²"></a>Nginx ä¸ Caddyï¼šç‰¹ç‚¹ã€åŒºåˆ«ä¸ Docker éƒ¨ç½²</h1><p>æœ¬æ–‡é¢å‘å¸¸è§çš„åå‘ä»£ç†ä¸é™æ€ç«™ç‚¹åœºæ™¯ï¼Œå¯¹æ¯” <strong>Nginx</strong> ä¸ <strong>Caddy</strong> çš„æ ¸å¿ƒç‰¹ç‚¹ä¸å·®å¼‚ï¼Œå¹¶ç»™å‡ºåœ¨ Windows ç¯å¢ƒä¸‹ä½¿ç”¨ <strong>Docker</strong> çš„å¿«é€Ÿéƒ¨ç½²ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æŒ‰éœ€é€‰æ‹©ä¸è½åœ°ã€‚</p><hr><h2 id="ä¸ºä»€ä¹ˆå…³æ³¨"><a href="#ä¸ºä»€ä¹ˆå…³æ³¨" class="headerlink" title="ä¸ºä»€ä¹ˆå…³æ³¨"></a>ä¸ºä»€ä¹ˆå…³æ³¨</h2><ul><li>ç»Ÿä¸€å…¥å£ï¼šåå‘ä»£ç†æ•´åˆå¤šæœåŠ¡ä¸è·¯ç”±ã€‚</li><li>HTTPS ä¸å®‰å…¨ï¼šè¯ä¹¦ä¸é‡å®šå‘ç­–ç•¥æ ‡å‡†åŒ–ç®¡ç†ã€‚</li><li>æ€§èƒ½ä¸ç¨³å®šï¼šé«˜å¹¶å‘ã€ä½èµ„æºå ç”¨ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚</li><li>æ˜“ç”¨æ€§ï¼šé…ç½®ã€çƒ­æ›´æ–°ä¸å¯è§‚æµ‹æ€§å½±å“è¿ç»´æ•ˆç‡ã€‚</li></ul><hr><h2 id="ç‰¹ç‚¹é€Ÿè§ˆ"><a href="#ç‰¹ç‚¹é€Ÿè§ˆ" class="headerlink" title="ç‰¹ç‚¹é€Ÿè§ˆ"></a>ç‰¹ç‚¹é€Ÿè§ˆ</h2><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><ul><li>é«˜æ€§èƒ½ä¸ä½èµ„æºå ç”¨ï¼Œæˆç†Ÿç”Ÿæ€ä¸å¹¿æ³›åº”ç”¨ã€‚</li><li>é…ç½®æ–‡ä»¶ï¼ˆ<code>nginx.conf</code>ï¼‰è¯­æ³•ç¨³å®šï¼Œé€‚åˆå¤æ‚è·¯ç”±ä¸è´Ÿè½½å‡è¡¡ã€‚</li><li>åå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡ï¼ˆ<code>upstream</code>ï¼‰ï¼Œé™æ€èµ„æºä¸ç¼“å­˜æ”¯æŒå¥½ã€‚</li><li>æ¨¡å—ç”Ÿæ€ä¸°å¯Œï¼ˆå¼€æº&#x2F;å•†ä¸šï¼‰ï¼Œç¤¾åŒºèµ„æ–™å¤šï¼Œæ’éšœæˆæœ¬ä½ã€‚</li><li>çƒ­é‡è½½é€šè¿‡ <code>nginx -s reload</code>ï¼Œæ”¯æŒé›¶åœæœºæ›´æ–°ã€‚</li></ul><h3 id="Caddy"><a href="#Caddy" class="headerlink" title="Caddy"></a>Caddy</h3><ul><li>å¼€ç®±å³ç”¨çš„è‡ªåŠ¨ HTTPSï¼ˆACMEï¼‰ï¼Œè¯ä¹¦è‡ªåŠ¨ç”³è¯·ä¸ç»­æœŸã€‚</li><li>ç®€æ´çš„ <code>Caddyfile</code> é…ç½®ï¼Œæ”¯æŒ JSON ä¸ Admin API åŠ¨æ€ç®¡ç†ã€‚</li><li>åå‘ä»£ç†ç®€å•ï¼ˆ<code>reverse_proxy</code>ï¼‰ï¼Œå†…ç½® HTTP&#x2F;2ã€HTTP&#x2F;3ï¼ˆQUICï¼‰ã€‚</li><li>ç»“æ„åŒ–æ—¥å¿—ä¸è‰¯å¥½é»˜è®¤å®‰å…¨ç­–ç•¥ï¼Œæ˜“äºç°ä»£åŒ–è¿ç»´ã€‚</li><li>æ’ä»¶ç”Ÿæ€æ´»è·ƒï¼ˆç›¸å¯¹æ›´å°ï¼‰ï¼ŒåŠŸèƒ½è¦†ç›–å¸¸ç”¨ç«™ç‚¹ä¸ç½‘å…³éœ€æ±‚ã€‚</li></ul><hr><h2 id="æ ¸å¿ƒåŒºåˆ«ä¸€è§ˆ"><a href="#æ ¸å¿ƒåŒºåˆ«ä¸€è§ˆ" class="headerlink" title="æ ¸å¿ƒåŒºåˆ«ä¸€è§ˆ"></a>æ ¸å¿ƒåŒºåˆ«ä¸€è§ˆ</h2><ul><li>é…ç½®ä¸ç®¡ç†ï¼š<ul><li>Nginx ä½¿ç”¨ <code>nginx.conf</code>ï¼Œçµæ´»ä½†è¯­æ³•åç¹ï¼›çƒ­é‡è½½é ä¿¡å·ã€‚</li><li>Caddy ä½¿ç”¨ <code>Caddyfile</code>ï¼ˆæˆ– JSONï¼‰ï¼Œæ›´ç®€æ´ï¼›Admin API æ”¯æŒåœ¨çº¿æ›´æ–°ã€é‡è½½ä¸æŸ¥è¯¢ã€‚</li></ul></li><li>HTTPS ä¸è¯ä¹¦ï¼š<ul><li>Nginx éœ€æ‰‹åŠ¨ç”³è¯·ä¸é…ç½®è¯ä¹¦ï¼ˆæˆ–è„šæœ¬è‡ªåŠ¨åŒ–ï¼‰ã€‚</li><li>Caddy è‡ªåŠ¨ç”³è¯·ä¸ç»­æœŸï¼Œé»˜è®¤å°† HTTP é‡å®šå‘åˆ° HTTPSï¼ˆéœ€å…¬ç½‘åŸŸåä¸ 80&#x2F;443 å¼€æ”¾ï¼‰ã€‚</li></ul></li><li>è´Ÿè½½å‡è¡¡ï¼š<ul><li>Nginx æä¾› <code>upstream</code> å¤šç­–ç•¥ï¼ˆè½®è¯¢ã€æœ€å°‘è¿æ¥ã€IP hashï¼‰ã€‚</li><li>Caddy åœ¨ <code>reverse_proxy</code> ä¸­å†…ç½®å¤šåç«¯ä¸å¥åº·æ£€æŸ¥ï¼Œé…ç½®æ›´ç›´è§‚ã€‚</li></ul></li><li>æ€§èƒ½ä¸èµ„æºï¼š<ul><li>ä¸¤è€…éƒ½éå¸¸é«˜æ•ˆï¼›Nginx æ›´â€œå·¥ä¸šåŒ–â€ã€å†…å­˜å ç”¨æ›´å°ã€‚</li><li>Caddy é»˜è®¤å¯ç”¨ç°ä»£åè®®ä¸å®‰å…¨ç‰¹æ€§ï¼Œæ•´ä½“å¼€é”€ç•¥é«˜ä½†é…ç½®æ›´çœå¿ƒã€‚</li></ul></li><li>å¯è§‚æµ‹æ€§ï¼š<ul><li>Nginx æ—¥å¿—ä¸ <code>stub_status</code>ï¼ˆæˆ–ç¬¬ä¸‰æ–¹æ¨¡å—ï¼‰å¸¸ç”¨ã€‚</li><li>Caddy æ—¥å¿—ç»“æ„åŒ–ï¼ŒAdmin API&#x2F;JSON çŠ¶æ€ä¾¿äºé›†æˆã€‚</li></ul></li></ul><p>é€‰æ‹©å»ºè®®ï¼š</p><ul><li>è¿½æ±‚â€œç¨³ã€å¹¿ã€ç»†æ§â€ç”¨ Nginxï¼›è¿½æ±‚â€œå¿«æ­å»ºã€è‡ªåŠ¨ HTTPSã€ç®€é…ç½®â€ç”¨ Caddyã€‚</li></ul><hr><h2 id="ä½¿ç”¨-Docker-éƒ¨ç½²-Nginx"><a href="#ä½¿ç”¨-Docker-éƒ¨ç½²-Nginx" class="headerlink" title="ä½¿ç”¨ Docker éƒ¨ç½² Nginx"></a>ä½¿ç”¨ Docker éƒ¨ç½² Nginx</h2><p>ä»¥ä¸‹ç¤ºä¾‹åŸºäº <strong>Docker Desktop for Windows</strong>ã€‚</p><h3 id="1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½é…ç½®ä¸é™æ€ç›®å½•ï¼‰"><a href="#1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½é…ç½®ä¸é™æ€ç›®å½•ï¼‰" class="headerlink" title="1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½é…ç½®ä¸é™æ€ç›®å½•ï¼‰"></a>1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½é…ç½®ä¸é™æ€ç›®å½•ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name nginx \<br>  -p 80:80 -p 443:443 \<br>  -v <span class="hljs-string">&quot;h:/data/nginx/conf:/etc/nginx&quot;</span> \<br>  -v <span class="hljs-string">&quot;h:/data/nginx/html:/usr/share/nginx/html&quot;</span> \<br>  -v <span class="hljs-string">&quot;h:/data/nginx/certs:/etc/nginx/certs&quot;</span> \<br>  nginx:stable<br></code></pre></td></tr></table></figure><ul><li><code>conf</code>ï¼šæ”¾ç½® <code>nginx.conf</code> ä¸ <code>conf.d/*.conf</code>ã€‚</li><li><code>html</code>ï¼šç«™ç‚¹é™æ€æ–‡ä»¶ç›®å½•ã€‚</li><li><code>certs</code>ï¼šè¯ä¹¦ä¸ç§é’¥ï¼ˆç”¨äº HTTPSï¼‰ã€‚</li></ul><h3 id="2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹ï¼ˆåå‘ä»£ç†-é™æ€ï¼‰"><a href="#2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹ï¼ˆåå‘ä»£ç†-é™æ€ï¼‰" class="headerlink" title="2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹ï¼ˆåå‘ä»£ç† + é™æ€ï¼‰"></a>2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹ï¼ˆåå‘ä»£ç† + é™æ€ï¼‰</h3><p><code>h:/data/nginx/conf/nginx.conf</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">worker_processes</span>  <span class="hljs-number">1</span>;<br><br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">1024</span>;<br>&#125;<br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br>    <span class="hljs-attribute">sendfile</span>      <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">keepalive_timeout</span> <span class="hljs-number">65</span>;<br><br>    <span class="hljs-comment"># é™æ€ç«™ç‚¹</span><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span> example.local;<br><br>        <span class="hljs-section">location</span> / &#123;<br>            <span class="hljs-attribute">root</span>  /usr/share/nginx/html;<br>            <span class="hljs-attribute">index</span> index.html;<br>        &#125;<br><br>        <span class="hljs-comment"># åå‘ä»£ç†åˆ°åç«¯æœåŠ¡</span><br>        <span class="hljs-section">location</span> /api/ &#123;<br>            <span class="hljs-attribute">proxy_pass</span> http://host.docker.internal:8080/;<br>            <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>            <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>HTTPS æç¤ºï¼š</p><ul><li>ç”Ÿäº§ç¯å¢ƒéœ€åœ¨ <code>server</code> ä¸­é…ç½® <code>listen 443 ssl;</code>ã€è¯ä¹¦è·¯å¾„ä¸å®‰å…¨å¥—ä»¶ã€‚</li><li>å¯é…åˆ <code>Letâ€™s Encrypt</code>&#x2F;<code>acme.sh</code> è‡ªåŠ¨åŒ–è¯ä¹¦ç”³è¯·ã€‚</li></ul><h3 id="3ï¼‰Docker-Composeï¼ˆæ¨èï¼‰"><a href="#3ï¼‰Docker-Composeï¼ˆæ¨èï¼‰" class="headerlink" title="3ï¼‰Docker Composeï¼ˆæ¨èï¼‰"></a>3ï¼‰Docker Composeï¼ˆæ¨èï¼‰</h3><p><code>docker-compose.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.8&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">nginx:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">nginx:stable</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">nginx</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;443:443&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/nginx/conf:/etc/nginx</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/nginx/html:/usr/share/nginx/html</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/nginx/certs:/etc/nginx/certs</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><p>è¿ç»´å¸¸ç”¨ï¼š</p><ul><li>é‡è½½é…ç½®ï¼š<code>docker exec nginx nginx -s reload</code></li><li>æŸ¥çœ‹æ—¥å¿—ï¼š<code>docker logs -f nginx</code></li></ul><hr><h2 id="ä½¿ç”¨-Docker-éƒ¨ç½²-Caddy"><a href="#ä½¿ç”¨-Docker-éƒ¨ç½²-Caddy" class="headerlink" title="ä½¿ç”¨ Docker éƒ¨ç½² Caddy"></a>ä½¿ç”¨ Docker éƒ¨ç½² Caddy</h2><h3 id="1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½-Caddyfile-ä¸æ•°æ®ç›®å½•ï¼‰"><a href="#1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½-Caddyfile-ä¸æ•°æ®ç›®å½•ï¼‰" class="headerlink" title="1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½ Caddyfile ä¸æ•°æ®ç›®å½•ï¼‰"></a>1ï¼‰è¿è¡Œå®¹å™¨ï¼ˆæŒ‚è½½ Caddyfile ä¸æ•°æ®ç›®å½•ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name caddy \<br>  -p 80:80 -p 443:443 -p 2019:2019 \<br>  -v <span class="hljs-string">&quot;h:/data/caddy/Caddyfile:/etc/caddy/Caddyfile&quot;</span> \<br>  -v <span class="hljs-string">&quot;h:/data/caddy/site:/srv&quot;</span> \<br>  -v <span class="hljs-string">&quot;h:/data/caddy/data:/data&quot;</span> \<br>  -v <span class="hljs-string">&quot;h:/data/caddy/config:/config&quot;</span> \<br>  caddy:2<br></code></pre></td></tr></table></figure><ul><li><code>Caddyfile</code>ï¼šæ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚</li><li><code>site</code>ï¼šé™æ€æ–‡ä»¶ç›®å½•ï¼ˆé…åˆ <code>file_server</code>ï¼‰ã€‚</li><li><code>2019</code>ï¼šAdmin APIï¼ˆå¯ç”¨äºçƒ­æ›´æ–°ä¸çŠ¶æ€æŸ¥è¯¢ï¼‰ã€‚</li><li><code>data/config</code>ï¼šè¯ä¹¦ä¸è¿è¡Œæ—¶é…ç½®æŒä¹…åŒ–ï¼ˆè‡ªåŠ¨ HTTPS éœ€è¦ï¼‰ã€‚</li></ul><h3 id="2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹"><a href="#2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹" class="headerlink" title="2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹"></a>2ï¼‰æœ€å°é…ç½®ç¤ºä¾‹</h3><p><code>h:/data/caddy/Caddyfile</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs caddy"># ç«™ç‚¹ + è‡ªåŠ¨ HTTPSï¼ˆéœ€å…¬ç½‘ DNS æŒ‡å‘æœ¬æœºï¼‰<br>example.com &#123;<br>    # é™æ€ç«™ç‚¹<br>    root * /srv<br>    file_server<br><br>    # åå‘ä»£ç†<br>    reverse_proxy host.docker.internal:8080<br>&#125;<br><br># æœ¬åœ°å¼€å‘ï¼ˆä¸ç”³è¯·è¯ä¹¦ï¼‰<br>:80 &#123;<br>    root * /srv<br>    file_server<br>    reverse_proxy host.docker.internal:8080<br>&#125;<br></code></pre></td></tr></table></figure><p>çƒ­é‡è½½ï¼š</p><ul><li>é€šè¿‡ Admin APIï¼š<code>curl -X POST localhost:2019/load -H &quot;Content-Type: text/caddyfile&quot; --data-binary @/etc/caddy/Caddyfile</code></li><li>æˆ–ç›´æ¥ï¼š<code>docker exec caddy caddy reload --config /etc/caddy/Caddyfile</code></li></ul><h3 id="3ï¼‰Docker-Composeï¼ˆæ¨èï¼‰-1"><a href="#3ï¼‰Docker-Composeï¼ˆæ¨èï¼‰-1" class="headerlink" title="3ï¼‰Docker Composeï¼ˆæ¨èï¼‰"></a>3ï¼‰Docker Composeï¼ˆæ¨èï¼‰</h3><p><code>docker-compose.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.8&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">caddy:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">caddy:2</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">caddy</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;80:80&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;443:443&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;2019:2019&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/caddy/Caddyfile:/etc/caddy/Caddyfile</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/caddy/site:/srv</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/caddy/data:/data</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/caddy/config:/config</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li>è‡ªåŠ¨ HTTPS éœ€è¦å¯è§£æçš„åŸŸåä¸ 80&#x2F;443 å¤–ç½‘è¿é€šï¼›å†…ç½‘æˆ–æœ¬åœ°å¼€å‘å¯ä½¿ç”¨ <code>:80</code> ç›‘å¬æˆ– <code>tls internal</code>ã€‚</li><li>Windows æŒ‚è½½è·¯å¾„éœ€åœ¨ Docker Desktop ä¸­å…±äº«å¹¶å…è®¸è®¿é—®å¯¹åº”ç£ç›˜ã€‚</li></ul><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ul><li>Nginx æ›´é€‚åˆåœ¨éœ€è¦ç²¾ç»†åŒ–æ§åˆ¶ã€èµ„æºå ç”¨æ›´å°ã€ç”Ÿæ€æ›´æˆç†Ÿçš„åœºæ™¯ä¸­ä½¿ç”¨ã€‚</li><li>Caddy æ›´é€‚åˆå¿«é€Ÿäº¤ä»˜ã€è‡ªåŠ¨ HTTPSã€ç°ä»£åè®®ä¸ç®€å•é…ç½®çš„åœºæ™¯ã€‚</li><li>ä¸¤è€…éƒ½å¯é€šè¿‡ Docker åœ¨ Windows ç¯å¢ƒå¿«é€Ÿéƒ¨ç½²ï¼›å»ºè®®ä½¿ç”¨ Compose ç®¡ç†é…ç½®ä¸æ•°æ®æŒä¹…åŒ–ï¼Œå¹¶ç»“åˆåå‘ä»£ç†ä¸é™æ€ç«™ç‚¹éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆã€‚</li></ul><p>â€”â€” <em>NowPion</em></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nginx</tag>
      
      <tag>Caddy</tag>
      
      <tag>Docker</tag>
      
      <tag>åå‘ä»£ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PostgreSQLç‰¹ç‚¹ä¸å®‰è£…</title>
    <link href="/2025/10/25/Postgresql%E7%89%B9%E7%82%B9%E4%B8%8E%E5%AE%89%E8%A3%85/"/>
    <url>/2025/10/25/Postgresql%E7%89%B9%E7%82%B9%E4%B8%8E%E5%AE%89%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<h1 id="PostgreSQL-ç‰¹ç‚¹ä¸å®‰è£…ï¼ˆDockerï¼‰"><a href="#PostgreSQL-ç‰¹ç‚¹ä¸å®‰è£…ï¼ˆDockerï¼‰" class="headerlink" title="PostgreSQL ç‰¹ç‚¹ä¸å®‰è£…ï¼ˆDockerï¼‰"></a>PostgreSQL ç‰¹ç‚¹ä¸å®‰è£…ï¼ˆDockerï¼‰</h1><p>è¿‘æœŸé¡¹ç›®å°†é‡‡ç”¨ <strong>PostgreSQL</strong> ä½œä¸ºæ ¸å¿ƒæ•°æ®åº“ã€‚æœ¬æ–‡æ¦‚è¿° PostgreSQL çš„å…³é”®ç‰¹æ€§ï¼Œå¹¶ç»™å‡ºåœ¨ Windows ç¯å¢ƒä¸‹ä½¿ç”¨ <strong>Docker</strong> çš„å¿«é€Ÿå®‰è£…ä¸å¸¸ç”¨è¿ç»´ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ ä½æˆæœ¬ã€å¯é‡å¤åœ°å®Œæˆæœ¬åœ°æˆ–æµ‹è¯•ç¯å¢ƒæ­å»ºã€‚</p><hr><h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-PostgreSQL"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-PostgreSQL" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© PostgreSQL"></a>ä¸ºä»€ä¹ˆé€‰æ‹© PostgreSQL</h2><ul><li>å¼€æºä¸”ä¼ä¸šçº§ï¼šéµå¾ª SQL æ ‡å‡†ã€åŠŸèƒ½å®Œæ•´ã€ç¤¾åŒºæ´»è·ƒã€‚</li><li>å¼ºä¸€è‡´äº‹åŠ¡ï¼šACID + MVCC æ”¯æŒé«˜å¹¶å‘è¯»å†™ä¸”ä¿è¯ä¸€è‡´æ€§ã€‚</li><li>ä¸°å¯Œæ•°æ®ç±»å‹ï¼š<code>JSON/JSONB</code>ã€æ•°ç»„ã€åœ°ç†ç©ºé—´ï¼ˆPostGISï¼‰ç­‰ä¸°å¯Œç±»å‹ã€‚</li><li>å¼ºå¤§ç´¢å¼•ï¼š<code>B-Tree</code>ã€<code>Hash</code>ã€<code>GIN</code>ã€<code>GiST</code>ã€<code>BRIN</code> è¦†ç›–å¤šåœºæ™¯æŸ¥è¯¢ã€‚</li><li>å¯æ‰©å±•ç”Ÿæ€ï¼šæ‰©å±•ã€æ’ä»¶å’Œå‡½æ•°ä¼—å¤šï¼Œé€‚åˆå¤æ‚ä¸šåŠ¡ä¸æ•°æ®åˆ†æã€‚</li><li>è·¨å¹³å°ï¼šLinuxã€macOSã€Windows é€šè¿‡ Docker ä¸€è‡´éƒ¨ç½²ä¸è¿ç»´ã€‚</li></ul><hr><h2 id="æ ¸å¿ƒç‰¹æ€§é€Ÿè§ˆ"><a href="#æ ¸å¿ƒç‰¹æ€§é€Ÿè§ˆ" class="headerlink" title="æ ¸å¿ƒç‰¹æ€§é€Ÿè§ˆ"></a>æ ¸å¿ƒç‰¹æ€§é€Ÿè§ˆ</h2><ul><li>äº‹åŠ¡ä¸å¹¶å‘ï¼šMVCC æ— é”è¯»ã€äº‹åŠ¡éš”ç¦»çº§åˆ«å¯é…ï¼Œé€‚åˆé«˜å¹¶å‘ä¸šåŠ¡ã€‚</li><li>JSONBï¼šåŸç”Ÿæ”¯æŒæ–‡æ¡£å‹æ•°æ®ä¸ç´¢å¼•ï¼Œå…¼é¡¾ç»“æ„åŒ–ä¸åŠç»“æ„åŒ–åœºæ™¯ã€‚</li><li>åˆ†åŒºä¸å¤åˆ¶ï¼šè¡¨åˆ†åŒºã€é€»è¾‘å¤åˆ¶ã€æµå¤åˆ¶ï¼Œé€‚åˆå¤§è¡¨ä¸é«˜å¯ç”¨æ–¹æ¡ˆã€‚</li><li>æ‰©å±•ç”Ÿæ€ï¼š<code>pg_stat_statements</code>ï¼ˆæ€§èƒ½åˆ†æï¼‰ã€<code>PostGIS</code>ï¼ˆGISï¼‰ã€<code>uuid-ossp</code>ï¼ˆUUIDï¼‰ç­‰ã€‚</li><li>ç´¢å¼•å¤šæ ·æ€§ï¼š<code>GIN</code> é€‚åˆå…¨æ–‡æ£€ç´¢&#x2F;JSONï¼Œ<code>GiST</code> é€‚åˆèŒƒå›´æˆ–ç©ºé—´ï¼Œ<code>BRIN</code> é€‚åˆè¶…å¤§é¡ºåºæ•°æ®ã€‚</li></ul><hr><h2 id="çŸ¥è¯†ç‚¹è¯¦è§£"><a href="#çŸ¥è¯†ç‚¹è¯¦è§£" class="headerlink" title="çŸ¥è¯†ç‚¹è¯¦è§£"></a>çŸ¥è¯†ç‚¹è¯¦è§£</h2><h3 id="æ¶æ„ä¸å­˜å‚¨"><a href="#æ¶æ„ä¸å­˜å‚¨" class="headerlink" title="æ¶æ„ä¸å­˜å‚¨"></a>æ¶æ„ä¸å­˜å‚¨</h3><ul><li>è¿›ç¨‹æ¨¡å‹ï¼šä¸»è¿›ç¨‹ï¼ˆ<code>postmaster</code>&#x2F;<code>postgres</code>ï¼‰+ æ¯è¿æ¥ä¸€ä¸ªåå°è¿›ç¨‹ï¼›è¾…åŠ©è¿›ç¨‹è´Ÿè´£ <code>WAL Writer</code>ã€<code>Background Writer</code>ã€<code>Checkpointer</code>ã€<code>Autovacuum</code> ç­‰ã€‚</li><li>æ•°æ®æ–‡ä»¶ç»„ç»‡ï¼šåº“ï¼ˆ<code>base/&lt;db_oid&gt;</code>ï¼‰â†’ è¡¨ï¼ˆå¤šä¸ªæ®µ <code>relfilenode</code>ï¼‰â†’ 8KB é¡µï¼ˆPageï¼‰â†’ è¡Œï¼ˆTupleï¼‰ã€‚</li><li>TOASTï¼šå¤§å­—æ®µï¼ˆå¦‚ <code>TEXT/JSONB</code>ï¼‰æº¢å‡ºåˆ° TOAST è¡¨ï¼Œé™ä½ä¸»è¡¨è†¨èƒ€ä¸ç¼“å†²å‹åŠ›ã€‚</li></ul><h3 id="MVCC-ä¸äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#MVCC-ä¸äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="MVCC ä¸äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>MVCC ä¸äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><ul><li>MVCCï¼šè¡Œç‰ˆæœ¬ + å¯è§æ€§è§„åˆ™ï¼Œè¯»ä¸é˜»å¡å†™ã€å†™ä¸é˜»å¡è¯»ã€‚</li><li>éš”ç¦»çº§åˆ«ï¼š<code>Read Committed</code>ï¼ˆé»˜è®¤ï¼‰ã€<code>Repeatable Read</code>ã€<code>Serializable</code>ã€‚</li><li>å¹»è¯»ä¸å†™åæ–œï¼š<code>Serializable</code> ä½¿ç”¨ SSI ç®—æ³•é™ä½å¼‚å¸¸å¹¶å‘ï¼›è°¨æ…é€‰æ‹©éš”ç¦»çº§åˆ«ä¸é”ç­–ç•¥ã€‚</li></ul><h3 id="WAL-ä¸æ£€æŸ¥ç‚¹"><a href="#WAL-ä¸æ£€æŸ¥ç‚¹" class="headerlink" title="WAL ä¸æ£€æŸ¥ç‚¹"></a>WAL ä¸æ£€æŸ¥ç‚¹</h3><ul><li>WALï¼ˆé¢„å†™æ—¥å¿—ï¼‰ï¼šç¡®ä¿å´©æºƒæ¢å¤ä¸å¤åˆ¶ï¼›é¡ºåºå†™ä¼˜åŒ– IOã€‚</li><li>Checkpointï¼šå°†è„é¡µåˆ·ç›˜å¹¶è®°å½• LSNï¼Œé™ä½æ¢å¤æ—¶é—´ï¼›é¢‘ç‡ä¸å¤§å°å½±å“æ€§èƒ½ã€‚</li><li>å…³é”®å‚æ•°ï¼š<code>wal_level</code>ã€<code>checkpoint_timeout</code>ã€<code>max_wal_size</code>ã€<code>min_wal_size</code>ã€<code>synchronous_commit</code>ã€‚</li></ul><h3 id="é”ä¸å¹¶å‘æ§åˆ¶"><a href="#é”ä¸å¹¶å‘æ§åˆ¶" class="headerlink" title="é”ä¸å¹¶å‘æ§åˆ¶"></a>é”ä¸å¹¶å‘æ§åˆ¶</h3><ul><li>è¡Œçº§é”ï¼š<code>FOR UPDATE/SHARE</code>ï¼›é¿å…é•¿äº‹åŠ¡æŒé”ã€‚</li><li>è¡¨çº§é”ï¼š<code>ACCESS SHARE/EXCLUSIVE</code> ç­‰ï¼›DDL å¯èƒ½è§¦å‘è¡¨çº§é”ã€‚</li><li>æ­»é”åˆ†æï¼š<code>pg_locks</code> + æ—¥å¿—ï¼›æ‹†åˆ†äº‹åŠ¡ã€å‡å°‘ç›¸äº’ä¾èµ–é¡ºåºã€‚</li></ul><h3 id="VACUUM-ANALYZE-ä¸-Autovacuum"><a href="#VACUUM-ANALYZE-ä¸-Autovacuum" class="headerlink" title="VACUUM&#x2F;ANALYZE ä¸ Autovacuum"></a>VACUUM&#x2F;ANALYZE ä¸ Autovacuum</h3><ul><li>VACUUMï¼šæ¸…ç†ä¸å¯è§è¡Œç‰ˆæœ¬ï¼Œé¿å…è†¨èƒ€ä¸ XID wraparoundã€‚</li><li>ANALYZEï¼šæ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œæå‡æŸ¥è¯¢è®¡åˆ’è´¨é‡ã€‚</li><li>Autovacuumï¼šè‡ªåŠ¨ç»´æŠ¤ï¼›å‚æ•°å¦‚ <code>autovacuum_vacuum_scale_factor</code>ã€<code>autovacuum_analyze_scale_factor</code> ä¸ <code>naptime</code> éœ€æŒ‰è¡¨è§„æ¨¡è°ƒä¼˜ã€‚</li></ul><h3 id="æŸ¥è¯¢ä¼˜åŒ–ä¸æ‰§è¡Œè®¡åˆ’"><a href="#æŸ¥è¯¢ä¼˜åŒ–ä¸æ‰§è¡Œè®¡åˆ’" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–ä¸æ‰§è¡Œè®¡åˆ’"></a>æŸ¥è¯¢ä¼˜åŒ–ä¸æ‰§è¡Œè®¡åˆ’</h3><ul><li>ä½¿ç”¨ <code>EXPLAIN (ANALYZE, BUFFERS)</code> è§‚å¯ŸçœŸå®è€—æ—¶ä¸ IOã€‚</li><li>å…³é”®ç®—å­ï¼š<code>Seq Scan</code>ã€<code>Index Scan</code>ã€<code>Bitmap Heap/Index Scan</code>ã€<code>Nested Loop</code>ã€<code>Hash Join</code>ã€<code>Merge Join</code>ã€‚</li><li>å¸¸è§ä¼˜åŒ–ï¼šåˆç†ç´¢å¼•ã€é¿å…å‡½æ•°å¯¹åˆ—åŒ…è£¹ã€åˆ†åŒºè£å‰ªã€æé«˜é€‰æ‹©æ€§ç»Ÿè®¡ã€é™åˆ¶è¿”å›åˆ—ä¸è¡Œæ•°ã€‚</li></ul><h3 id="ç´¢å¼•ç±»å‹ä¸é€‚ç”¨åœºæ™¯"><a href="#ç´¢å¼•ç±»å‹ä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="ç´¢å¼•ç±»å‹ä¸é€‚ç”¨åœºæ™¯"></a>ç´¢å¼•ç±»å‹ä¸é€‚ç”¨åœºæ™¯</h3><ul><li><code>B-Tree</code>ï¼šé€šç”¨æ¯”è¾ƒä¸æ’åºã€å‰ç¼€åŒ¹é…ã€‚</li><li><code>Hash</code>ï¼šç­‰å€¼æŸ¥è¯¢ï¼›PostgreSQL ç°æ”¯æŒ WALï¼Œä½†æ€»ä½“ç”¨å¾—è¾ƒå°‘ã€‚</li><li><code>GIN</code>ï¼šå€’æ’ç´¢å¼•ï¼Œé€‚åˆ <code>JSONB</code>ã€å…¨æ–‡æ£€ç´¢ã€æ•°ç»„åŒ…å«ã€‚</li><li><code>GiST</code>ï¼šèŒƒå›´ã€ç©ºé—´ã€ç›¸ä¼¼åº¦ï¼›é…åˆ PostGISã€trigram ç›¸ä¼¼åº¦ç­‰ã€‚</li><li><code>BRIN</code>ï¼šè¶…å¤§é¡ºåºæ•°æ®ï¼ˆæ—¶é—´&#x2F;è‡ªå¢ IDï¼‰ï¼Œä½ç»´æŠ¤æˆæœ¬ã€‚</li><li>éƒ¨åˆ†ç´¢å¼•&#x2F;è¡¨è¾¾å¼ç´¢å¼•ï¼šæé«˜ç‰¹å®šæ¡ä»¶&#x2F;å‡½æ•°æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><h3 id="åˆ†åŒºè¡¨ä¸æœ€ä½³å®è·µ"><a href="#åˆ†åŒºè¡¨ä¸æœ€ä½³å®è·µ" class="headerlink" title="åˆ†åŒºè¡¨ä¸æœ€ä½³å®è·µ"></a>åˆ†åŒºè¡¨ä¸æœ€ä½³å®è·µ</h3><ul><li>èŒƒå¼ï¼š<code>RANGE/LIST/HASH</code> åˆ†åŒºï¼›æŒ‰æ—¶é—´æˆ–ä¸šåŠ¡é”®åˆ†åŒºæœ€å¸¸è§ã€‚</li><li>å¥½å¤„ï¼šè£å‰ªåŠ é€ŸæŸ¥è¯¢ã€åŠ é€Ÿå½’æ¡£ä¸ç»´æŠ¤ã€é™ä½ç´¢å¼•ä½“é‡ã€‚</li><li>æ³¨æ„ï¼šä¸»é”®&#x2F;å”¯ä¸€çº¦æŸéœ€é…åˆåˆ†åŒºé”®ï¼›è·¨åˆ†åŒºæ›´æ–°æ…ç”¨ï¼›ç»Ÿè®¡ä¸ Autovacuum ç­–ç•¥éœ€é¢å‘å„åˆ†åŒºã€‚</li></ul><h3 id="å¤åˆ¶ä¸é«˜å¯ç”¨"><a href="#å¤åˆ¶ä¸é«˜å¯ç”¨" class="headerlink" title="å¤åˆ¶ä¸é«˜å¯ç”¨"></a>å¤åˆ¶ä¸é«˜å¯ç”¨</h3><ul><li>ç‰©ç†å¤åˆ¶ï¼šä¸»ä»æµå¤åˆ¶ï¼ˆ<code>wal_level=replica</code>ï¼‰ï¼›å¤‡åº“åªè¯»ã€‚</li><li>é€»è¾‘å¤åˆ¶ï¼šæŒ‰è¡¨çº§å‘å¸ƒ&#x2F;è®¢é˜…ï¼›é€‚åˆæ•°æ®è¿ç§»ä¸å¼‚æ„åŒæ­¥ã€‚</li><li>åŒæ­¥ä¸å¼‚æ­¥ï¼šåŒæ­¥å¤åˆ¶ç¡®ä¿æäº¤å®‰å…¨ã€ç‰ºç‰²å»¶è¿Ÿï¼›å¼‚æ­¥å¤åˆ¶æ€§èƒ½å¥½ä½†å¯èƒ½ä¸¢å¤±æå°‘é‡äº‹åŠ¡ã€‚</li></ul><h3 id="å¤‡ä»½ä¸æ¢å¤ç­–ç•¥"><a href="#å¤‡ä»½ä¸æ¢å¤ç­–ç•¥" class="headerlink" title="å¤‡ä»½ä¸æ¢å¤ç­–ç•¥"></a>å¤‡ä»½ä¸æ¢å¤ç­–ç•¥</h3><ul><li>é€»è¾‘å¤‡ä»½ï¼š<code>pg_dump/pg_restore</code>ï¼Œé€‚åˆç»“æ„è¿ç§»ä¸å°å‹åº“å¤‡ä»½ã€‚</li><li>ç‰©ç†å¤‡ä»½ï¼šåŸºäºæ•°æ®ç›®å½• + WALï¼ˆå¦‚ <code>pg_basebackup</code>ï¼‰ï¼Œé€‚åˆå¤§åº“ä¸ç²¾å‡†æ—¶é—´ç‚¹æ¢å¤ï¼ˆPITRï¼‰ã€‚</li><li>PITRï¼šé€šè¿‡ <code>restore_command</code> + WAL å½’æ¡£ï¼Œå®šä½åˆ°æŒ‡å®šæ—¶é—´æˆ– LSNã€‚</li></ul><h3 id="æƒé™æ¨¡å‹ä¸å®‰å…¨å®è·µ"><a href="#æƒé™æ¨¡å‹ä¸å®‰å…¨å®è·µ" class="headerlink" title="æƒé™æ¨¡å‹ä¸å®‰å…¨å®è·µ"></a>æƒé™æ¨¡å‹ä¸å®‰å…¨å®è·µ</h3><ul><li>è§’è‰²ä¸æƒé™ï¼š<code>ROLE</code> å¯ <code>LOGIN</code>ï¼Œé€šè¿‡ <code>GRANT</code> èµ‹æƒåˆ°å¯¹è±¡çº§ï¼ˆåº“ã€æ¨¡å¼ã€è¡¨ã€åºåˆ—ã€å‡½æ•°ï¼‰ã€‚</li><li>æœ€å°æƒé™åŸåˆ™ï¼šåº”ç”¨ç”¨æˆ·åªç»™æ‰€éœ€ DML æƒé™ï¼›åˆ†ç¦» DDL ä¸ç®¡ç†è§’è‰²ã€‚</li><li>å®‰å…¨é…ç½®ï¼š<code>password_encryption</code>ã€<code>pg_hba.conf</code> è®¿é—®æ§åˆ¶ã€SSL&#x2F;TLSã€‚</li></ul><h3 id="æ‰©å±•ä¸å¸¸ç”¨æ’ä»¶"><a href="#æ‰©å±•ä¸å¸¸ç”¨æ’ä»¶" class="headerlink" title="æ‰©å±•ä¸å¸¸ç”¨æ’ä»¶"></a>æ‰©å±•ä¸å¸¸ç”¨æ’ä»¶</h3><ul><li><code>pg_stat_statements</code>ï¼šæ…¢æŸ¥è¯¢åˆ†æä¸ SQL èšåˆç»Ÿè®¡ã€‚</li><li><code>uuid-ossp</code> æˆ– <code>pgcrypto</code>ï¼šç”Ÿæˆ&#x2F;å¤„ç† UUIDã€‚</li><li><code>postgis</code>ï¼šGIS èƒ½åŠ›ï¼›ç©ºé—´ç´¢å¼•ä¸ç©ºé—´æŸ¥è¯¢ã€‚</li><li><code>pg_trgm</code>ï¼šç›¸ä¼¼åº¦ä¸æ¨¡ç³ŠåŒ¹é…ï¼ˆæ”¯æŒ <code>%LIKE%</code> ä¼˜åŒ–ä¸æœç´¢ï¼‰ã€‚</li></ul><h3 id="JSONB-å®æˆ˜æŠ€å·§"><a href="#JSONB-å®æˆ˜æŠ€å·§" class="headerlink" title="JSONB å®æˆ˜æŠ€å·§"></a>JSONB å®æˆ˜æŠ€å·§</h3><ul><li>æ“ä½œç¬¦ï¼š<code>-&gt;</code>ï¼ˆå–å¯¹è±¡ï¼‰ã€<code>-&gt;&gt;</code>ï¼ˆæ–‡æœ¬ï¼‰ã€<code>@&gt;</code>ï¼ˆåŒ…å«ï¼‰ã€<code>?</code>ï¼ˆé”®å­˜åœ¨ï¼‰ã€‚</li><li>ç´¢å¼•å»ºè®®ï¼š<code>GIN</code> + <code>jsonb_path_ops</code> æå‡åŒ…å«æŸ¥è¯¢ï¼›ä¸ºå¸¸ç”¨è·¯å¾„å»ºè¡¨è¾¾å¼ç´¢å¼•ã€‚</li></ul><h3 id="æ—¶é—´ä¸æ—¶åŒºå¤„ç†"><a href="#æ—¶é—´ä¸æ—¶åŒºå¤„ç†" class="headerlink" title="æ—¶é—´ä¸æ—¶åŒºå¤„ç†"></a>æ—¶é—´ä¸æ—¶åŒºå¤„ç†</h3><ul><li>ä½¿ç”¨ <code>TIMESTAMPTZ</code> å­˜å‚¨å¸¦æ—¶åŒºæ—¶é—´ï¼›ç»Ÿä¸€ç”¨ UTC å…¥åº“ã€ä¸šåŠ¡å±‚æŒ‰åœ°åŒºæ˜¾ç¤ºã€‚</li><li>è®¾ç½® <code>TimeZone</code> ä¸ <code>IntervalStyle</code>ï¼Œé¿å…å¤ä»¤æ—¶ç­‰è¾¹ç•Œé—®é¢˜ã€‚</li></ul><h3 id="ç®¡ç†ä¸è°ƒä¼˜å¸¸è§å‚æ•°"><a href="#ç®¡ç†ä¸è°ƒä¼˜å¸¸è§å‚æ•°" class="headerlink" title="ç®¡ç†ä¸è°ƒä¼˜å¸¸è§å‚æ•°"></a>ç®¡ç†ä¸è°ƒä¼˜å¸¸è§å‚æ•°</h3><ul><li>å†…å­˜ï¼š<code>shared_buffers</code>ï¼ˆ25% RAM èµ·æ­¥ï¼‰ã€<code>work_mem</code>ï¼ˆæŒ‰å¹¶å‘æ§åˆ¶ï¼‰ã€<code>maintenance_work_mem</code>ã€‚</li><li>å¹¶å‘ï¼š<code>max_connections</code>ï¼ˆé…åˆè¿æ¥æ± ï¼‰ã€<code>effective_cache_size</code>ï¼ˆä¼°ç®—ç³»ç»Ÿç¼“å­˜ï¼‰ã€‚</li><li>å†™å…¥ï¼š<code>wal_compression</code>ã€<code>synchronous_commit</code>ã€<code>checkpoint_completion_target</code>ã€‚</li></ul><h3 id="å¸¸ç”¨è¿ç»´å‘½ä»¤"><a href="#å¸¸ç”¨è¿ç»´å‘½ä»¤" class="headerlink" title="å¸¸ç”¨è¿ç»´å‘½ä»¤"></a>å¸¸ç”¨è¿ç»´å‘½ä»¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿æ¥</span><br>psql <span class="hljs-string">&quot;postgres://pguser:pgpass@localhost:5432/demo&quot;</span><br><span class="hljs-comment"># æŸ¥çœ‹ä¼šè¯ä¸é”</span><br>\conninfo<br>SELECT * FROM pg_stat_activity;<br>SELECT * FROM pg_locks;<br><span class="hljs-comment"># ç´¢å¼•ä¸è¡¨ç»Ÿè®¡</span><br>\d+ public.user_profile<br>SELECT * FROM pg_stat_user_tables;<br><span class="hljs-comment"># æ‰§è¡Œè®¡åˆ’</span><br>EXPLAIN (ANALYZE, BUFFERS) SELECT * FROM public.user_profile WHERE <span class="hljs-built_in">id</span> &lt; 1000;<br></code></pre></td></tr></table></figure><h3 id="psql-å¸¸ç”¨å¿«æ·"><a href="#psql-å¸¸ç”¨å¿«æ·" class="headerlink" title="psql å¸¸ç”¨å¿«æ·"></a>psql å¸¸ç”¨å¿«æ·</h3><ul><li><code>\l</code> åˆ—å‡ºæ•°æ®åº“ï¼Œ<code>\c dbname</code> åˆ‡æ¢ï¼Œ<code>\dt</code> åˆ—å‡ºè¡¨ï¼Œ<code>\di</code> ç´¢å¼•ã€‚</li><li><code>\x</code> åˆ‡æ¢æ‰©å±•æ˜¾ç¤ºï¼Œ<code>\timing</code> æ‰“å¼€è®¡æ—¶ï¼Œ<code>\watch</code> å¾ªç¯æ‰§è¡Œå½“å‰æŸ¥è¯¢ã€‚</li></ul><hr><h2 id="ä½¿ç”¨-Docker-å®‰è£…-PostgreSQL"><a href="#ä½¿ç”¨-Docker-å®‰è£…-PostgreSQL" class="headerlink" title="ä½¿ç”¨ Docker å®‰è£… PostgreSQL"></a>ä½¿ç”¨ Docker å®‰è£… PostgreSQL</h2><p>ä»¥ä¸‹ç¤ºä¾‹åŸºäº <strong>Docker Desktop for Windows</strong>ã€‚</p><h3 id="1ï¼‰æ‹‰å–é•œåƒ"><a href="#1ï¼‰æ‹‰å–é•œåƒ" class="headerlink" title="1ï¼‰æ‹‰å–é•œåƒ"></a>1ï¼‰æ‹‰å–é•œåƒ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker pull postgres:16<br></code></pre></td></tr></table></figure><h3 id="2ï¼‰å¯åŠ¨å®¹å™¨ï¼ˆæŒä¹…åŒ–æ•°æ®ï¼‰"><a href="#2ï¼‰å¯åŠ¨å®¹å™¨ï¼ˆæŒä¹…åŒ–æ•°æ®ï¼‰" class="headerlink" title="2ï¼‰å¯åŠ¨å®¹å™¨ï¼ˆæŒä¹…åŒ–æ•°æ®ï¼‰"></a>2ï¼‰å¯åŠ¨å®¹å™¨ï¼ˆæŒä¹…åŒ–æ•°æ®ï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>  --name postgres16 \<br>  -e POSTGRES_USER=pguser \<br>  -e POSTGRES_PASSWORD=pgpass \<br>  -e POSTGRES_DB=demo \<br>  -e TZ=Asia/Shanghai \<br>  -p 5432:5432 \<br>  -v <span class="hljs-string">&quot;h:/data/postgres:/var/lib/postgresql/data&quot;</span> \<br>  postgres:16<br></code></pre></td></tr></table></figure><ul><li><code>POSTGRES_USER/POSTGRES_PASSWORD/POSTGRES_DB</code>ï¼šåˆå§‹åŒ–ç”¨æˆ·ã€å¯†ç ä¸æ•°æ®åº“ã€‚</li><li><code>-v h:/data/postgres:/var/lib/postgresql/data</code>ï¼šå°†æ•°æ®æŒä¹…åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼ˆç¡®ä¿ Docker Desktop å…±äº«äº†è¯¥ç›˜ï¼‰ã€‚</li><li><code>-p 5432:5432</code>ï¼šæ˜ å°„ä¸»æœºç«¯å£åˆ°å®¹å™¨ç«¯å£ã€‚</li><li><code>TZ</code>ï¼šè®¾ç½®æ—¶åŒºï¼Œä¾¿äºæ—¥å¿—ä¸æ—¶é—´ä¸€è‡´ã€‚</li></ul><p>æŸ¥çœ‹å®¹å™¨çŠ¶æ€ä¸æ—¥å¿—ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker ps<br>docker logs -f postgres16<br></code></pre></td></tr></table></figure><h3 id="3ï¼‰è¿æ¥æµ‹è¯•"><a href="#3ï¼‰è¿æ¥æµ‹è¯•" class="headerlink" title="3ï¼‰è¿æ¥æµ‹è¯•"></a>3ï¼‰è¿æ¥æµ‹è¯•</h3><ul><li>æœ¬æœºå·¥å…·ï¼š<code>psql -h localhost -U pguser -d demo</code>ï¼ˆé¦–æ¬¡ä¼šæç¤ºè¾“å…¥å¯†ç  <code>pgpass</code>ï¼‰ã€‚</li><li>è¿æ¥ä¸²ï¼š<code>postgres://pguser:pgpass@localhost:5432/demo</code>ã€‚</li><li>Java&#x2F;JDBCï¼š<code>jdbc:postgresql://localhost:5432/demo</code>ã€‚</li></ul><hr><h2 id="ä½¿ç”¨-Docker-Composeï¼ˆæ¨èï¼‰"><a href="#ä½¿ç”¨-Docker-Composeï¼ˆæ¨èï¼‰" class="headerlink" title="ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰"></a>ä½¿ç”¨ Docker Composeï¼ˆæ¨èï¼‰</h2><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»º <code>docker-compose.yml</code>ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">&quot;3.8&quot;</span><br><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">postgres:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:16</span><br>    <span class="hljs-attr">container_name:</span> <span class="hljs-string">postgres16</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">POSTGRES_USER:</span> <span class="hljs-string">pguser</span><br>      <span class="hljs-attr">POSTGRES_PASSWORD:</span> <span class="hljs-string">pgpass</span><br>      <span class="hljs-attr">POSTGRES_DB:</span> <span class="hljs-string">demo</span><br>      <span class="hljs-attr">TZ:</span> <span class="hljs-string">Asia/Shanghai</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">&quot;5432:5432&quot;</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">./data/postgres:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨ä¸å…³é—­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker compose up -d<br>docker compose down<br></code></pre></td></tr></table></figure><blockquote><p>å°†æ•°æ®ç›®å½•æ˜ å°„ä¸º <code>./data/postgres</code>ï¼Œä¾¿äºé¡¹ç›®å†…ç»Ÿä¸€ç®¡ç†ã€‚</p></blockquote><hr><h2 id="å¸¸ç”¨è¿ç»´ç¤ºä¾‹"><a href="#å¸¸ç”¨è¿ç»´ç¤ºä¾‹" class="headerlink" title="å¸¸ç”¨è¿ç»´ç¤ºä¾‹"></a>å¸¸ç”¨è¿ç»´ç¤ºä¾‹</h2><h3 id="åˆ›å»ºç”¨æˆ·ä¸æ•°æ®åº“"><a href="#åˆ›å»ºç”¨æˆ·ä¸æ•°æ®åº“" class="headerlink" title="åˆ›å»ºç”¨æˆ·ä¸æ•°æ®åº“"></a>åˆ›å»ºç”¨æˆ·ä¸æ•°æ®åº“</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- è¿›å…¥ psql åæ‰§è¡Œï¼š</span><br><span class="hljs-keyword">CREATE</span> ROLE appuser <span class="hljs-keyword">WITH</span> LOGIN PASSWORD <span class="hljs-string">&#x27;appPass&#x27;</span> NOSUPERUSER;<br><span class="hljs-keyword">CREATE</span> DATABASE appdb OWNER appuser;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> DATABASE appdb <span class="hljs-keyword">TO</span> appuser;<br></code></pre></td></tr></table></figure><h3 id="åŸºæœ¬è¡¨ä¸ç´¢å¼•"><a href="#åŸºæœ¬è¡¨ä¸ç´¢å¼•" class="headerlink" title="åŸºæœ¬è¡¨ä¸ç´¢å¼•"></a>åŸºæœ¬è¡¨ä¸ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> public.user_profile (<br>  id         BIGSERIAL <span class="hljs-keyword">PRIMARY KEY</span>,<br>  nickname   TEXT,<br>  attrs      JSONB,<br>  created_at TIMESTAMPTZ <span class="hljs-keyword">DEFAULT</span> NOW()<br>);<br><br><span class="hljs-comment">-- JSONB çš„ GIN ç´¢å¼•ï¼ˆé€‚åˆé”®å€¼ã€å…¨æ–‡æ£€ç´¢ç­‰ï¼‰</span><br><span class="hljs-keyword">CREATE</span> INDEX idx_user_profile_attrs_gin <span class="hljs-keyword">ON</span> public.user_profile <span class="hljs-keyword">USING</span> GIN (attrs);<br></code></pre></td></tr></table></figure><h3 id="å¤‡ä»½ä¸æ¢å¤ï¼ˆå®¹å™¨å†…æ‰§è¡Œï¼‰"><a href="#å¤‡ä»½ä¸æ¢å¤ï¼ˆå®¹å™¨å†…æ‰§è¡Œï¼‰" class="headerlink" title="å¤‡ä»½ä¸æ¢å¤ï¼ˆå®¹å™¨å†…æ‰§è¡Œï¼‰"></a>å¤‡ä»½ä¸æ¢å¤ï¼ˆå®¹å™¨å†…æ‰§è¡Œï¼‰</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é€»è¾‘å¤‡ä»½ï¼ˆå¯¼å‡ºä¸º .sqlï¼‰</span><br>docker <span class="hljs-built_in">exec</span> -t postgres16 pg_dump -U pguser -d demo &gt; demo_backup.sql<br><br><span class="hljs-comment"># æ¢å¤ï¼ˆå…ˆåˆ›å»ºç©ºåº“ï¼Œå†æ‰§è¡Œå¯¼å…¥ï¼‰</span><br>docker <span class="hljs-built_in">exec</span> -i postgres16 psql -U pguser -d demo &lt; demo_backup.sql<br></code></pre></td></tr></table></figure><h3 id="æ€§èƒ½ä¸ç»´æŠ¤å»ºè®®"><a href="#æ€§èƒ½ä¸ç»´æŠ¤å»ºè®®" class="headerlink" title="æ€§èƒ½ä¸ç»´æŠ¤å»ºè®®"></a>æ€§èƒ½ä¸ç»´æŠ¤å»ºè®®</h3><ul><li>å¼€å¯å¹¶è§‚å¯Ÿ <code>pg_stat_statements</code> è¿›è¡Œæ…¢æŸ¥è¯¢åˆ†æã€‚</li><li>åˆç†è®¾ç½®ï¼š<code>shared_buffers</code>ã€<code>work_mem</code>ã€<code>effective_cache_size</code>ï¼ˆç”Ÿäº§ç¯å¢ƒæŒ‰èµ„æºè°ƒä¼˜ï¼‰ã€‚</li><li>å®šæœŸ <code>VACUUM</code>&#x2F;<code>ANALYZE</code> ä¿æŒç»Ÿè®¡ä¿¡æ¯ä¸ç©ºé—´å¥åº·ã€‚</li><li>é’ˆå¯¹å¤§è¡¨ä½¿ç”¨åˆ†åŒºä¸åˆé€‚çš„ç´¢å¼•ç±»å‹ï¼Œé¿å…å…¨è¡¨æ‰«æã€‚</li></ul><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>PostgreSQL ä»¥å¼ºä¸€è‡´äº‹åŠ¡ã€ä¸°å¯Œç´¢å¼•ä¸æ‰©å±•ç”Ÿæ€è‘—ç§°ï¼Œæ—¢èƒ½æ”¯æ’‘ä¼ ç»Ÿ OLTPï¼Œä¹Ÿèƒ½å…¼é¡¾æ–‡æ¡£ä¸åˆ†æåœºæ™¯ã€‚ç»“åˆ Dockerï¼Œå¯ä»¥åœ¨æœ¬åœ°ä¸æµ‹è¯•ç¯å¢ƒå®ç°å¿«é€Ÿã€å¯é‡å¤çš„éƒ¨ç½²ä¸è¿ç»´ã€‚å®é™…è½åœ°æ—¶ï¼Œå»ºè®®è¯„ä¼°æ•°æ®è§„æ¨¡ä¸ä¸šåŠ¡ç‰¹ç‚¹ï¼Œåˆç†é€‰æ‹©ç´¢å¼•ä¸åˆ†åŒºç­–ç•¥ï¼Œå¹¶ä½¿ç”¨ <code>pg_stat_statements</code> æŒç»­ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>â€”â€” <em>NowPion</em></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
      <tag>PostgreSQL</tag>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å°è®°</title>
    <link href="/2025/10/22/%E5%B0%8F%E8%AE%B0/"/>
    <url>/2025/10/22/%E5%B0%8F%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="å°è®°"><a href="#å°è®°" class="headerlink" title="å°è®°"></a>å°è®°</h1><blockquote><p>è¿™é‡Œå…ˆä¸åˆ†äº«æŠ€æœ¯ï¼Œæƒ³å†™ç‚¹æœ€è¿‘çš„å¿ƒæƒ…ä¸ä¸€äº›æ„Ÿæ‚Ÿã€‚<br>æ„¿æœ‰ç¼˜äººçœ‹åˆ°ã€‚</p></blockquote><hr><h2 id="æœ€è¿‘çš„ç”Ÿæ´»"><a href="#æœ€è¿‘çš„ç”Ÿæ´»" class="headerlink" title="æœ€è¿‘çš„ç”Ÿæ´»"></a>æœ€è¿‘çš„ç”Ÿæ´»</h2><p>æœ€è¿‘åœ¨å­¦æ ¡æ¥äº†ä¸€ä¸ªé¡¹ç›®ï¼Œ3q å¤šæ‹¿ä¸‹ï¼Œä¸€ä¸ª Node.js å…¨æ ˆé¡¹ç›®ã€‚<br>ä½†å› ä¸ºå¯¹æ–¹è¦æŠŠä»·æ ¼ç åˆ° 2qï¼Œåœ¨æˆ‘è·Ÿä»–è®ºä»·æ—¶ï¼Œä»–é‚£è¾¹å°±å·²ç»æŠŠäººæ‰¾å¥½äº†ã€‚<br>æˆ‘ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ›´å¥½çš„åŠæ³•ï¼Œåªèƒ½æ¥å—äº†â€”â€”ç®—æ˜¯æ›´ç›´è§‚åœ°æ„Ÿå—åˆ°â€œå·â€ã€‚<br>è¿™æ¬¡ä¹Ÿæé†’æˆ‘ï¼šè°ˆä»·æ ¼ä¹‹å¤–ï¼Œæ›´è¦è°ˆæ¸…â€œéœ€æ±‚èŒƒå›´ã€äº¤ä»˜æ ‡å‡†ä¸è¾¹ç•Œâ€ã€‚</p><hr><h2 id="ä¸€äº›æ€è€ƒ"><a href="#ä¸€äº›æ€è€ƒ" class="headerlink" title="ä¸€äº›æ€è€ƒ"></a>ä¸€äº›æ€è€ƒ</h2><p>å…³äºâ€œå·â€çš„å‡ ä»¶äº‹â€”â€”</p><ol><li><p>ä»€ä¹ˆæ˜¯â€œå·â€ï¼š<br>å¹¶ä¸æ˜¯ç®€å•çš„â€œåŠªåŠ›â€ï¼Œè€Œæ˜¯å¤§å®¶åœ¨åŒä¸€èµ›é“ä¸Šï¼ŒæŠ•å…¥è¶Šæ¥è¶Šå¤šï¼Œä½†è¾¹é™…å›æŠ¥å´è¶Šæ¥è¶Šä½ã€‚æ•™è‚²ã€èŒåœºã€äº’è”ç½‘è¡Œä¸šå°¤ä¸ºæ˜æ˜¾ã€‚</p></li><li><p>ä¸ºä»€ä¹ˆä¼šâ€œå·â€ï¼š<br>ä¾›éœ€ä¸å¹³è¡¡ï¼ˆå²—ä½å°‘ã€ç«äº‰è€…å¤šï¼‰ï¼Œä¿¡æ¯è¿‡åº¦é€æ˜ï¼ˆäººäººéƒ½èƒ½å¯¹æ ‡æœ€ä¼˜ï¼‰ï¼Œä»¥åŠç»©æ•ˆå¯¼å‘çš„æ–‡åŒ–ï¼ˆåªçœ‹ç»“æœã€ä¸é—®è¿‡ç¨‹ï¼‰ï¼Œå…±åŒæ¨åŠ¨äº†â€œå¼ºå¯¹æŠ—â€çš„ç¯å¢ƒã€‚</p></li><li><p>â€œå·â€çš„å¸¸è§è¡¨ç°ï¼š<br>ä»·æ ¼æˆ˜ã€è¿‡åº¦åŠ ç­ã€å †è¯ä¹¦ä¸é¡¹ç›®åè¯ã€ç–²äºç¤¾äº¤ä¸æ›å…‰ã€‚å¾ˆå¤šæ—¶å€™ä¸æ˜¯ä¸ºäº†æ›´å¥½ï¼Œè€Œæ˜¯ä¸ºäº†â€œä¸è¾“â€ã€‚</p></li><li><p>ä¸ªä½“çš„åº”å¯¹ï¼š</p><ul><li>å®šä¹‰è¾¹ç•Œï¼šæ¸…æ¥šè‡ªå·±èƒ½æ‰¿å—çš„å·¥ä½œå¼ºåº¦ä¸ç”Ÿæ´»èŠ‚å¥ã€‚</li><li>æå‡ç¨€ç¼ºæ€§ï¼šå°‘åœ¨çº¢æµ·é‡Œæ‹¼æ¶ˆè€—ï¼Œå¤šåœ¨ç»†åˆ†é¢†åŸŸç§¯ç´¯ç‹¬ç‰¹ç»éªŒä¸ä½œå“ã€‚</li><li>é€‰æ‹©èµ›é“ï¼šåˆ¤æ–­è¡Œä¸šçš„å‘¨æœŸä¸è¶‹åŠ¿ï¼Œå­¦ä¼šâ€œæ¢é“â€è€Œä¸æ˜¯ç¡¬é¡¶ã€‚</li><li>å¤ç›˜ä¸é•¿æœŸä¸»ä¹‰ï¼šç”¨åŠå¹´ã€ä¸€å¹´çš„å°ºåº¦çœ‹æˆé•¿ï¼Œè€Œä¸æ˜¯ä¸€ä¸¤æ¬¡è°ˆä»·æˆè´¥ã€‚</li></ul></li><li><p>å…·ä½“åˆ°æˆ‘çš„ç»å†ï¼š<br>ä»·æ ¼è¢«å‹ã€å¯¹æ–¹å¦æ‰¾äººï¼Œè¿™äº›å¹¶ä¸ç­‰äºâ€œæˆ‘ä¸å€¼å¾—â€ï¼Œæ›´åƒæ˜¯ç»™è‡ªå·±ä¸€æ¬¡å†è¯„ä¼°ä¸å†å®šä½çš„æœºä¼šã€‚ä¸‹ä¸€æ¬¡ï¼Œä¸åªè°ˆä»·æ ¼ï¼Œä¹Ÿè°ˆèŒƒå›´ã€äº§å‡ºä¸ä»·å€¼è¯æ˜ã€‚</p></li><li><p>ä¸€å¥æé†’ï¼š<br>å·ä¸å¯é¿å…ï¼Œä½†â€œæ€ä¹ˆå·â€å¯é€‰æ‹©ã€‚æŠŠç«äº‰å˜æˆè‡ªæˆ‘æ‰“ç£¨ï¼ŒæŠŠçŸ­æœŸå˜æˆé•¿æœŸï¼ŒæŠŠæƒ…ç»ªå˜æˆæ–¹æ³•ã€‚</p></li></ol><hr><h2 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h2><p>æŠŠå½“ä¸‹çš„å¿™ä¸ç´¯åŒ–ä¸ºç§¯ç´¯ï¼ŒæŠŠçŸ­æš‚çš„æŒ«è´¥åŒ–ä¸ºç»éªŒï¼›ç»§ç»­æŠŠä½œå“æ‰“ç£¨å¥½ï¼Œå®‰é™åšäº‹ï¼Œè®¤çœŸç”Ÿæ´»ã€‚</p><hr><p><em>è®°å½•äº 2025å¹´10æœˆ</em></p>]]></content>
    
    
    <categories>
      
      <category>ç”Ÿæ´»éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
      <tag>ç”Ÿæ´»</tag>
      
      <tag>æ„Ÿæ‚Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é«˜æ•ˆåˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡ä»£ç è§£æ</title>
    <link href="/2025/10/18/%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90%E5%99%A8/"/>
    <url>/2025/10/18/%E5%88%86%E5%B8%83%E5%BC%8FID%E7%94%9F%E6%88%90%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="åˆ†å¸ƒå¼IDç”Ÿæˆ"><a href="#åˆ†å¸ƒå¼IDç”Ÿæˆ" class="headerlink" title="åˆ†å¸ƒå¼IDç”Ÿæˆ"></a>åˆ†å¸ƒå¼IDç”Ÿæˆ</h1><p>æœ¬æ–‡ä»¥ä¸€ä¸ªå…·ä½“ Java é¡¹ç›®ä»£ç ä¸ºä¾‹ï¼Œè§£æå…¶æ ¸å¿ƒ ID ç”Ÿæˆé€»è¾‘åŠè®¾è®¡äº®ç‚¹ã€‚<br>æ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç†è§£å¦‚ä½•ç»“åˆæœ¬åœ°ç¼“å­˜å’Œå¼‚æ­¥æ›´æ–°ç­–ç•¥ï¼Œå®ç°é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼ ID ç”ŸæˆæœåŠ¡ã€‚</p><hr><h2 id="é¡¹ç›®èƒŒæ™¯"><a href="#é¡¹ç›®èƒŒæ™¯" class="headerlink" title="é¡¹ç›®èƒŒæ™¯"></a>é¡¹ç›®èƒŒæ™¯</h2><p>è¯¥æœåŠ¡æä¾› <strong>é¡ºåºID</strong> å’Œ <strong>æ— åºID</strong> ä¸¤ç§ç”Ÿæˆæ–¹å¼ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯ä¸‹ ID å¿«é€Ÿåˆ†é…ã€‚<br>ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘æ•°æ®åº“è®¿é—®å‹åŠ›ï¼Œé€šè¿‡å¼‚æ­¥åˆ·æ–°æœºåˆ¶å®ç° ID åŒºé—´åŠ¨æ€æ›´æ–°ï¼Œä¿éšœ ID ç”Ÿæˆçš„æ•ˆç‡ä¸å”¯ä¸€æ€§ã€‚</p><hr><h2 id="æ•°æ®åº“è¡¨è®¾è®¡"><a href="#æ•°æ®åº“è¡¨è®¾è®¡" class="headerlink" title="æ•°æ®åº“è¡¨è®¾è®¡"></a>æ•°æ®åº“è¡¨è®¾è®¡</h2><p>æ ¸å¿ƒè¡¨ <code>t_id_generate_config</code> ç”¨äºå­˜å‚¨å„ä¸šåŠ¡ ID é…ç½®åŠå·æ®µä¿¡æ¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE TABLE</span> `t_id_generate_config` (<br> `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;ä¸»é”® id&#x27;</span>,<br> `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æè¿°&#x27;</span>,<br> `next_threshold` <span class="hljs-type">bigint</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å½“å‰ id æ‰€åœ¨é˜¶æ®µçš„é˜ˆå€¼&#x27;</span>,<br> `init_num` <span class="hljs-type">bigint</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;åˆå§‹åŒ–å€¼&#x27;</span>,<br> `current_start` <span class="hljs-type">bigint</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;å½“å‰ id æ‰€åœ¨é˜¶æ®µçš„å¼€å§‹å€¼&#x27;</span>,<br> `step` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;id é€’å¢åŒºé—´&#x27;</span>,<br> `is_seq` tinyint <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;æ˜¯å¦æœ‰åºï¼ˆ0 æ— åºï¼Œ1 æœ‰åºï¼‰&#x27;</span>,<br> `id_prefix` <span class="hljs-type">varchar</span>(<span class="hljs-number">60</span>) <span class="hljs-keyword">CHARACTER SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;ä¸šåŠ¡å‰ç¼€ç ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›æ—¶ä¸æºå¸¦&#x27;</span>,<br> `version` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;ä¹è§‚é”ç‰ˆæœ¬å·&#x27;</span>,<br> `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;åˆ›å»ºæ—¶é—´&#x27;</span>,<br> `update_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">&#x27;æ›´æ–°æ—¶é—´&#x27;</span>,<br> <span class="hljs-keyword">PRIMARY KEY</span> (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">8</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <strong>è‡ªå¢ä¸»é”®</strong> ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚</li><li><code>is_seq</code> æ ‡è®°æ˜¯å¦ä¸ºé¡ºåº IDã€‚</li><li><code>version</code> ç”¨äºä¹è§‚é”ï¼Œé˜²æ­¢å¤šå®ä¾‹å†²çªã€‚</li><li><code>current_start</code> å’Œ <code>next_threshold</code> å®šä¹‰å·æ®µèŒƒå›´ã€‚</li></ul><hr><h2 id="æ ¸å¿ƒä»£ç å‰–æ"><a href="#æ ¸å¿ƒä»£ç å‰–æ" class="headerlink" title="æ ¸å¿ƒä»£ç å‰–æ"></a>æ ¸å¿ƒä»£ç å‰–æ</h2><h3 id="1ï¸âƒ£-æœ¬åœ°ç¼“å­˜ç»“æ„"><a href="#1ï¸âƒ£-æœ¬åœ°ç¼“å­˜ç»“æ„" class="headerlink" title="1ï¸âƒ£ æœ¬åœ°ç¼“å­˜ç»“æ„"></a>1ï¸âƒ£ æœ¬åœ°ç¼“å­˜ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é¡ºåºIDç¼“å­˜</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;Integer, LocalSeqIdBo&gt; localSeqIdBoMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br><br><span class="hljs-comment">// æ— åºIDç¼“å­˜</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;Integer, LocalUnSeqIdBo&gt; localUnSeqIdBoMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><ul><li><strong>é¡ºåºIDç¼“å­˜</strong>ç»´æŠ¤å½“å‰é€’å¢è®¡æ•°åŠåŒºé—´é˜ˆå€¼ã€‚</li><li><strong>æ— åºIDç¼“å­˜</strong>ç»´æŠ¤ä¸€ä¸ªæ‰“ä¹±é¡ºåºçš„ ID é˜Ÿåˆ—ï¼Œæ—¢æ”¯æŒè¿ç»­ ID ç”Ÿæˆï¼Œåˆæ»¡è¶³æ— åºéœ€æ±‚ã€‚</li></ul><hr><h3 id="2ï¸âƒ£-ID-ç”Ÿæˆé€»è¾‘"><a href="#2ï¸âƒ£-ID-ç”Ÿæˆé€»è¾‘" class="headerlink" title="2ï¸âƒ£ ID ç”Ÿæˆé€»è¾‘"></a>2ï¸âƒ£ ID ç”Ÿæˆé€»è¾‘</h3><p><strong>é¡ºåº ID</strong>ç”Ÿæˆé€šè¿‡è°ƒç”¨ <code>incrementAndGet</code> å®ç°çº¿ç¨‹å®‰å…¨é€’å¢ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">returnId</span> <span class="hljs-operator">=</span> localSeqIdBo.getCurrentNum().incrementAndGet();<br></code></pre></td></tr></table></figure><p><strong>æ— åº ID</strong>ç”Ÿæˆé€šè¿‡ä»æœ¬åœ°çš„ ID é˜Ÿåˆ—ä¸­ <code>poll</code> ä¸€ä¸ª IDï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Long</span> <span class="hljs-variable">pollId</span> <span class="hljs-operator">=</span> localUnSeqIdBo.getIdQueue().poll();<br></code></pre></td></tr></table></figure><p>ä¸¤ç§æ–¹å¼æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯çš„ ID ç”Ÿæˆéœ€æ±‚ã€‚</p><hr><h3 id="3ï¸âƒ£-å¼‚æ­¥åˆ·æ–°æœºåˆ¶"><a href="#3ï¸âƒ£-å¼‚æ­¥åˆ·æ–°æœºåˆ¶" class="headerlink" title="3ï¸âƒ£ å¼‚æ­¥åˆ·æ–°æœºåˆ¶"></a>3ï¸âƒ£ å¼‚æ­¥åˆ·æ–°æœºåˆ¶</h3><p>å½“ç¼“å­˜ ID ä½¿ç”¨è¿›åº¦è¾¾åˆ°åŒºé—´çš„ <strong>75%</strong> æ—¶ï¼Œä»£ç é‡‡ç”¨ <strong>ä¿¡å·é‡ + çº¿ç¨‹æ± </strong> æ§åˆ¶å¼‚æ­¥åˆ·æ–° ID åŒºé—´ï¼Œé˜²æ­¢å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°æ•°æ®åº“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(localSeqIdBo.getCurrentNum().get() - localSeqIdBo.getCurrentStart() &gt; step * UPDATE_RATE)&#123;<br>    <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> semaphoreMap.get(localSeqIdBo.getId());<br>    <span class="hljs-keyword">if</span>(semaphore.tryAcquire())&#123;<br>        threadPoolExecutor.execute(() -&gt; &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                tryUpdateMysqlRecord(idGenerateMapper.selectById(localSeqIdBo.getId()));<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                LOGGER.error(<span class="hljs-string">&quot;åŒæ­¥å¤±è´¥&quot;</span>, e);<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                semaphoreMap.get(localSeqIdBo.getId()).release();<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¼‚æ­¥æ›´æ–°æå‡å“åº”é€Ÿåº¦ã€‚</li><li>ä¿¡å·é‡ä¿è¯æ›´æ–°å•ä¸€æ€§ï¼Œé¿å…å¤šçº¿ç¨‹å†²çªã€‚</li></ul><hr><h3 id="4ï¸âƒ£-å¹¶å‘æ§åˆ¶ä¸çº¿ç¨‹æ± "><a href="#4ï¸âƒ£-å¹¶å‘æ§åˆ¶ä¸çº¿ç¨‹æ± " class="headerlink" title="4ï¸âƒ£ å¹¶å‘æ§åˆ¶ä¸çº¿ç¨‹æ± "></a>4ï¸âƒ£ å¹¶å‘æ§åˆ¶ä¸çº¿ç¨‹æ± </h3><ul><li>ä½¿ç”¨ <strong>Semaphore</strong> ç¡®ä¿æ•°æ®åº“æ›´æ–°æ“ä½œäº’æ–¥è®¿é—®ã€‚</li><li>ä½¿ç”¨å¸¦è‡ªå®šä¹‰å‘½åçº¿ç¨‹çš„ <strong>çº¿ç¨‹æ± </strong> æå‡å¼‚æ­¥æ‰§è¡Œæ•ˆç‡ï¼Œä¿è¯é«˜å¹¶å‘ç¯å¢ƒç¨³å®šå®‰å…¨ã€‚</li></ul><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¯¥ ID ç”ŸæˆæœåŠ¡è®¾è®¡å·§å¦™ç»“åˆäº†ï¼š</p><ul><li>æœ¬åœ°ç¼“å­˜</li><li>é«˜å¹¶å‘æ§åˆ¶</li><li>å¼‚æ­¥åˆ·æ–°æœºåˆ¶</li></ul><p>æå¤§é™ä½æ•°æ®åº“å‹åŠ›ï¼Œå®ç°äº†é«˜æ€§èƒ½çš„åˆ†å¸ƒå¼ ID ç”Ÿæˆã€‚<br>é€‚åˆå•å®ä¾‹æˆ–æœ‰é™å¤šå®ä¾‹éƒ¨ç½²åœºæ™¯ï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤ã€‚</p><blockquote><p>ç†è§£å’Œå€Ÿé‰´å…¶è®¾è®¡æ€è·¯ï¼Œæœ‰åŠ©äºæ„å»ºç¨³å®šé«˜æ•ˆçš„åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€ç»„ä»¶ã€‚</p></blockquote><p>â€”â€” <em>NowPion</em></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åˆ†å¸ƒå¼</tag>
      
      <tag>IDç”Ÿæˆ</tag>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢</title>
    <link href="/2025/10/18/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87/"/>
    <url>/2025/10/18/%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E7%AF%87/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢"><a href="#æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢" class="headerlink" title="æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢"></a>æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢</h1><p>è¿™æ˜¯æˆ‘ä½¿ç”¨ <strong>Hexo</strong> æ­å»ºçš„ç¬¬ä¸€ç¯‡æ–‡ç« ã€‚<br>ç»è¿‡ä¸€ç•ªé…ç½®ä¸è°ƒè¯•ï¼Œç»ˆäºæŠŠè¿™ä¸ªåšå®¢è·‘èµ·æ¥äº†ã€‚<br>è™½ç„¶åªæ˜¯ä¸€ä¸ªç®€å•çš„å¼€å§‹ï¼Œä½†è¿™å¯¹æˆ‘æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªæ–°çš„èµ·ç‚¹ã€‚</p><hr><h2 id="ä¸ºä»€ä¹ˆè¦å†™åšå®¢"><a href="#ä¸ºä»€ä¹ˆè¦å†™åšå®¢" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å†™åšå®¢"></a>ä¸ºä»€ä¹ˆè¦å†™åšå®¢</h2><p>ä¸»è¦æœ‰ä¸‰ä¸ªåŸå› ï¼š</p><ol><li><p><strong>è®°å½•æˆé•¿</strong>ï¼š<br>æ¯ä¸€æ¬¡è§£å†³é—®é¢˜ã€å®Œæˆé¡¹ç›®ã€æˆ–è€…å¶ç„¶çš„çµæ„Ÿï¼Œéƒ½å€¼å¾—è¢«è®°å½•ä¸‹æ¥ã€‚<br>å†™ä¸‹æ¥ä¸ä»…èƒ½å¸®åŠ©è‡ªå·±å¤ç›˜ï¼Œä¹Ÿèƒ½å¸®åŠ©åæ¥è€…å°‘èµ°å¼¯è·¯ã€‚</p></li><li><p><strong>æ•´ç†æ€è·¯</strong>ï¼š<br>å½“ä½ å°è¯•æŠŠçŸ¥è¯†å†™å‡ºæ¥çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°ç†è§£ä¼šæ›´æ·±ã€‚<br>å†™åšå®¢å…¶å®å°±æ˜¯ä¸€ç§æœ€å¥½çš„å­¦ä¹ æ–¹å¼ã€‚</p></li><li><p><strong>åˆ†äº«ä»·å€¼</strong>ï¼š<br>æˆ‘ç›¸ä¿¡çŸ¥è¯†æ˜¯å¯ä»¥åˆ†äº«çš„ã€‚<br>å¦‚æœæˆ‘çš„æ–‡ç« èƒ½è®©æŸä¸ªäººå°‘æŸ¥ä¸€ç‚¹èµ„æ–™ï¼Œé‚£å°±å¾ˆå€¼å¾—ã€‚</p></li></ol><hr><h2 id="æˆ‘çš„æŠ€æœ¯æ–¹å‘"><a href="#æˆ‘çš„æŠ€æœ¯æ–¹å‘" class="headerlink" title="æˆ‘çš„æŠ€æœ¯æ–¹å‘"></a>æˆ‘çš„æŠ€æœ¯æ–¹å‘</h2><p>ç›®å‰ä¸»è¦å­¦ä¹ å’Œä½¿ç”¨çš„æŠ€æœ¯åŒ…æ‹¬ï¼š</p><ul><li>å…¨æ ˆå¼€å‘ï¼š<code>convex</code></li><li>åç«¯å¼€å‘ï¼š<code>Spring Boot</code>ã€<code>Spring Cloud</code>ã€<code>Node.js</code></li><li>æ•°æ®åº“ï¼š<code>MySQL</code>  ã€<code>Redis</code>ã€<code>Sql Server</code></li><li>å‰ç«¯æ¡†æ¶ï¼š<code>Vue</code>ã€<code>Uniapp</code>ã€<code>å¾®ä¿¡å°ç¨‹åº</code>  </li><li>éƒ¨ç½²ï¼š<code>Docker</code>ã€<code>Linux</code>  </li><li>AIå¼€å‘å·¥å…·ï¼š<code>Trea</code>ã€<code>Cursor</code></li><li>å…¶ä»–å…´è¶£ï¼šç‰©è”ç½‘ã€æ•°æ®åˆ†æã€æŠ€æœ¯æ¢ç´¢</li></ul><hr><h2 id="æœªæ¥è®¡åˆ’"><a href="#æœªæ¥è®¡åˆ’" class="headerlink" title="æœªæ¥è®¡åˆ’"></a>æœªæ¥è®¡åˆ’</h2><p>è¿™ä¸ªåšå®¢ä¼šé™†ç»­æ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>é¡¹ç›®å®æˆ˜ç¬”è®°ä¸æŠ€æœ¯æ€»ç»“  </li><li>ç¼–ç¨‹ä¸å­¦ä¹ æ–¹æ³•åˆ†äº«  </li><li>ä¸ªäººæ€è€ƒä¸ç”Ÿæ´»è®°å½•</li></ul><p>å¸Œæœ›èƒ½åœ¨è¿™é‡Œä¸æ–­æˆé•¿ï¼Œä¹ŸæœŸå¾…é‡è§å¿—åŒé“åˆçš„æœ‹å‹ã€‚</p><hr><h2 id="è”ç³»æˆ‘"><a href="#è”ç³»æˆ‘" class="headerlink" title="è”ç³»æˆ‘"></a>è”ç³»æˆ‘</h2><p>ä¸‹é¢æ˜¯æˆ‘çš„è”ç³»æ–¹å¼ï¼š</p><ul><li>qqï¼š3163443477</li><li>wxï¼šdong17854000761  </li><li>é‚®ç®±ï¼š<a href="mailto:&#110;&#105;&#x65;&#122;&#x68;&#105;&#x64;&#x6f;&#110;&#103;&#49;&#x32;&#51;&#52;&#64;&#x67;&#109;&#97;&#105;&#108;&#x2e;&#99;&#x6f;&#109;">&#110;&#105;&#x65;&#122;&#x68;&#105;&#x64;&#x6f;&#110;&#103;&#49;&#x32;&#51;&#52;&#64;&#x67;&#109;&#97;&#105;&#108;&#x2e;&#99;&#x6f;&#109;</a></li></ul><hr><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><blockquote><p>ã€Œè®°å½•è®©äººæˆé•¿ï¼Œåˆ†äº«è®©ä¸–ç•Œå˜å¾—æ›´å¥½ã€‚ã€</p></blockquote><p>æ„Ÿè°¢ä½ èƒ½çœ‹åˆ°è¿™é‡Œã€‚<br>å¦‚æœä½ ä¹Ÿåœ¨æ­å»ºè‡ªå·±çš„åšå®¢ï¼Œå¯ä»¥ç•™è¨€äº¤æµï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥ã€‚  </p><p>â€”â€” <em>NowPion</em></p>]]></content>
    
    
    
    <tags>
      
      <tag>éšç¬”</tag>
      
      <tag>æ–°èµ·ç‚¹</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
